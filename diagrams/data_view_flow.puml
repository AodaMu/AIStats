@startuml æ•°æ®è§†å›¾å’Œå€¼æ ‡ç­¾é¡µé¢è¿è¡Œæµç¨‹
skinparam sequenceMessageAlign center
participant "ç”¨æˆ·" as User
participant "Streamlit UI" as UI
participant "Session State" as State
participant "data_view.py" as DataView
participant "pandas" as Pandas
participant "variable_labels.py" as Labels

User -> UI: 1. ç‚¹å‡»"ðŸ“ æ•°æ®è§†å›¾"
activate UI

UI -> DataView: åˆå§‹åŒ–æ•°æ®è§†å›¾æ¨¡å—
activate DataView

DataView -> State: æ£€æŸ¥session_stateä¸­çš„æ•°æ®
activate State
State --> DataView: è¿”å›žçŽ°æœ‰æ•°æ®(å¦‚æœ‰)
deactivate State

DataView -> UI: æ˜¾ç¤ºå¯¼å…¥ç•Œé¢
deactivate DataView

User -> UI: 2. é€‰æ‹©æ•°æ®æ–‡ä»¶(CSV/Excel)
UI -> DataView: è°ƒç”¨load_data()
activate DataView

DataView -> Pandas: è¯»å–æ–‡ä»¶
activate Pandas
Pandas --> DataView: è¿”å›žDataFrame
deactivate Pandas

DataView -> State: ä¿å­˜æ•°æ®åˆ°session_state
activate State
State --> DataView: ç¡®è®¤ä¿å­˜
deactivate State

DataView -> UI: æ˜¾ç¤ºæ•°æ®é¢„è§ˆå’Œç»Ÿè®¡ä¿¡æ¯
deactivate DataView

User -> UI: 3. æŸ¥çœ‹æ•°æ®é¢„è§ˆ(å‰100è¡Œ)
UI -> DataView: èŽ·å–é¢„è§ˆæ•°æ®
activate DataView
DataView -> State: è¯»å–æ•°æ®
State --> DataView: è¿”å›žDataFrame
DataView --> UI: æ˜¾ç¤ºè¡¨æ ¼
deactivate DataView

User -> UI: 4. ç‚¹å‡»"å˜é‡æ ‡ç­¾ç®¡ç†"
UI -> Labels: åˆå§‹åŒ–æ ‡ç­¾ç®¡ç†æ¨¡å—
activate Labels

Labels -> State: èŽ·å–å½“å‰æ•°æ®çš„åˆ—å
activate State
State --> Labels: è¿”å›žåˆ—ååˆ—è¡¨
deactivate State

Labels -> UI: æ˜¾ç¤ºå˜é‡æ ‡ç­¾ç¼–è¾‘ç•Œé¢
deactivate Labels

User -> UI: 5. ç¼–è¾‘å˜é‡æ ‡ç­¾
UI -> Labels: æ›´æ–°æ ‡ç­¾
activate Labels

Labels -> State: ä¿å­˜æ ‡ç­¾åˆ°session_state
activate State
State --> Labels: ç¡®è®¤ä¿å­˜
deactivate State

Labels -> UI: åˆ·æ–°æ˜¾ç¤º
deactivate Labels

User -> UI: 6. ä½¿ç”¨VLOOKUPè‡ªåŠ¨åŒ¹é…æ ‡ç­¾
UI -> Labels: è°ƒç”¨vlookup_labels()
activate Labels

Labels -> Pandas: ä»Žæ•°æ®å­—å…¸æ–‡ä»¶è¯»å–æ˜ å°„
activate Pandas
Pandas --> Labels: è¿”å›žæ˜ å°„è¡¨
deactivate Pandas

Labels -> State: è‡ªåŠ¨æ›´æ–°åŒ¹é…çš„æ ‡ç­¾
activate State
State --> Labels: ç¡®è®¤æ›´æ–°
deactivate State

Labels -> UI: æ˜¾ç¤ºåŒ¹é…ç»“æžœ
deactivate Labels

User -> UI: 7. å¯¼å‡ºæ•°æ®
UI -> DataView: è°ƒç”¨export_data()
activate DataView

DataView -> State: èŽ·å–æ•°æ®å’Œæ ‡ç­¾
activate State
State --> DataView: è¿”å›žæ•°æ®å’Œæ ‡ç­¾
deactivate State

DataView -> Pandas: å¯¼å‡ºä¸ºCSVæˆ–Excel
activate Pandas
Pandas --> DataView: è¿”å›žæ–‡ä»¶å­—èŠ‚æµ
deactivate Pandas

DataView -> UI: æä¾›ä¸‹è½½æŒ‰é’®
deactivate DataView

User -> UI: 8. ä¸‹è½½æ–‡ä»¶
UI --> User: è¿”å›žå¯¼å‡ºæ–‡ä»¶

deactivate UI

@enduml
