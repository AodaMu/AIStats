# AIStatsé¡¹ç›®Bugæ£€æŸ¥æŠ¥å‘Š

## ğŸ“‹ æ£€æŸ¥æ—¥æœŸï¼š2025-11-06

---

## âœ… å·²ä¿®å¤çš„Bugï¼ˆæœ¬æ¬¡ä¼šè¯ï¼‰

### 1. âœ… æ··åˆç±»å‹æ’åºé”™è¯¯
- **é—®é¢˜**ï¼š`could not convert string to float: 'æ˜Ÿ'`
- **åŸå› **ï¼šå¯¹åŒ…å«æ•°å­—å’Œå­—ç¬¦ä¸²çš„æ··åˆç±»å‹åˆ—è¡¨ç›´æ¥æ’åº
- **ä½ç½®**ï¼š5å¤„ï¼ˆstat_functions.py, ai_view_v2.py, label_view.pyÃ—2, variable_labels.pyï¼‰
- **çŠ¶æ€**ï¼šå·²å…¨éƒ¨ä¿®å¤

### 2. âœ… AIç¼–é€ æ•°æ®é—®é¢˜
- **é—®é¢˜**ï¼šAIç»™å‡ºçš„ç»Ÿè®¡æ•°æ®ä¸å®é™…ç»“æœä¸ç¬¦
- **åŸå› **ï¼šç¬¬äºŒæ¬¡è°ƒç”¨AIæ—¶æ²¡æœ‰ä¼ é€’å®é™…ç»Ÿè®¡ç»“æœ
- **ä½ç½®**ï¼šai_view_v2.py ç¬¬713è¡Œ
- **çŠ¶æ€**ï¼šå·²ä¿®å¤

### 3. âœ… æ ‡ç­¾æ®‹ç•™é—®é¢˜
- **é—®é¢˜**ï¼šåˆ‡æ¢æ•°æ®åæ—§æ ‡ç­¾ä»ç„¶å­˜åœ¨
- **åŸå› **ï¼šç¼ºå°‘è‡ªåŠ¨æ¸…ç†æœºåˆ¶
- **ä½ç½®**ï¼šdata_view.py, label_view.py
- **çŠ¶æ€**ï¼šå·²æ·»åŠ è‡ªåŠ¨æ£€æµ‹å’Œæ¸…ç†åŠŸèƒ½

### 4. âœ… æç¤ºè¯ç¡¬ç¼–ç ç¤ºä¾‹
- **é—®é¢˜**ï¼šæç¤ºè¯ä¸­åŒ…å«"å…­å¹´çº§"ç­‰å›ºå®šç¤ºä¾‹ï¼Œè¯¯å¯¼AI
- **åŸå› **ï¼šç¤ºä¾‹å¤ªå…·ä½“
- **ä½ç½®**ï¼šai_view_v2.py ç³»ç»Ÿæç¤ºè¯
- **çŠ¶æ€**ï¼šå·²æ”¹ä¸ºé€šç”¨ç¤ºä¾‹

### 5. âœ… å¹´çº§è¢«é”™è¯¯å½“ä½œæ•°å€¼å‹å˜é‡
- **é—®é¢˜**ï¼šå¹´çº§è®¡ç®—å‡å€¼7.85è€Œä¸æ˜¯ç»Ÿè®¡é¢‘æ¬¡
- **åŸå› **ï¼šç¼ºå°‘æ™ºèƒ½ç±»å‹åˆ¤æ–­
- **ä½ç½®**ï¼šstat_functions.py
- **çŠ¶æ€**ï¼šå·²æ·»åŠ å€¼æ ‡ç­¾å’Œå”¯ä¸€å€¼æ•°é‡åˆ¤æ–­

### 6. âœ… AIåˆ†æç¼ºå°‘å­¦æœ¯ä¾æ®
- **é—®é¢˜**ï¼šç›´æ¥ç»™ç»“è®ºï¼Œä¸è¯´æ˜ç»Ÿè®¡ä¾æ®
- **ä½ç½®**ï¼šæ‰€æœ‰AIåˆ†ææç¤ºè¯
- **çŠ¶æ€**ï¼šå·²å¼ºåˆ¶è¦æ±‚å…ˆè¯´ç»Ÿè®¡ä¾æ®

### 7. âœ… AIåˆ†æç¼ºå°‘æ˜ç¡®ç»“è®º
- **é—®é¢˜**ï¼šè¯´"éœ€è¦è¿›ä¸€æ­¥åˆ†æ"è€Œä¸ç»™å‡ºæ˜ç¡®åˆ¤æ–­
- **ä½ç½®**ï¼šæ‰€æœ‰AIåˆ†ææç¤ºè¯
- **çŠ¶æ€**ï¼šå·²è¦æ±‚ç»™å‡ºæœ‰/æ— å…³ç³»çš„æ˜ç¡®ç»“è®º

---

## âš ï¸ å‘ç°çš„æ½œåœ¨Bug

### âœ… Bug #1ï¼šé™¤é›¶é”™è¯¯é£é™©ï¼ˆå·²ä¿®å¤ï¼‰

**ä½ç½®1**ï¼š`src/lib/stat_functions.py` ç¬¬262è¡Œ
```python
t = r * np.sqrt(n - 2) / np.sqrt(1 - r**2)
```

**é—®é¢˜**ï¼š
- å½“ `r = 1.0` æˆ– `r = -1.0`ï¼ˆå®Œå…¨ç›¸å…³ï¼‰æ—¶ï¼Œ`1 - r**2 = 0`ï¼Œä¼šå¯¼è‡´é™¤é›¶é”™è¯¯
- å½“ `n = 2` æ—¶ï¼Œ`n - 2 = 0`ï¼Œä¼šå¯¼è‡´å¹³æ–¹æ ¹0

**å½±å“**ï¼šPearsonç›¸å…³åˆ†æå¯èƒ½å´©æºƒ

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```python
if abs(r) >= 0.9999:
    # å®Œå…¨ç›¸å…³æˆ–å®Œå…¨è´Ÿç›¸å…³ï¼Œpå€¼æå°
    p_matrix[var1][var2] = 0.0
else:
    t = r * np.sqrt(n - 2) / np.sqrt(1 - r**2)
    p = 2 * (1 - stats.t.cdf(abs(t), n - 2))
    p_matrix[var1][var2] = float(p)
```

**ä¿®å¤ä½ç½®**ï¼š
- âœ… `src/lib/stat_functions.py` ç¬¬269-276è¡Œï¼ˆå·²ä¿®å¤ï¼‰
- âœ… `src/components/stat_view.py` ç¬¬678-685è¡Œï¼ˆå·²ä¿®å¤ï¼‰

**ä¿®å¤æ—¶é—´**ï¼š2025-11-06

---

### Bug #2ï¼šç©ºæ•è·å¼‚å¸¸ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

**ä½ç½®1**ï¼š`src/lib/stat_functions.py` ç¬¬112è¡Œ
```python
except:
    is_multiple_choice = False
```

**é—®é¢˜**ï¼š
- è£¸exceptä¼šæ•è·æ‰€æœ‰å¼‚å¸¸ï¼ŒåŒ…æ‹¬ç³»ç»Ÿé”™è¯¯
- éš¾ä»¥è°ƒè¯•é—®é¢˜

**å»ºè®®ä¿®å¤**ï¼š
```python
except Exception as e:
    is_multiple_choice = False
```

**ä½ç½®2**ï¼š`src/components/label_view.py` ç¬¬118ã€157è¡Œ
åŒæ ·çš„é—®é¢˜ã€‚

---

### Bug #3ï¼šAPI Keyç¡¬ç¼–ç ï¼ˆå®‰å…¨é£é™©ï¼‰âš ï¸

**ä½ç½®**ï¼š`app.py` ç¬¬37è¡Œ
```python
'api_key': 'sk-6299528af8be4fffa13ae14a20f0db69',
```

**é—®é¢˜**ï¼š
- API Keyç›´æ¥å†™åœ¨ä»£ç ä¸­
- å¦‚æœä»£ç ä¸Šä¼ åˆ°GitHubï¼ŒKeyä¼šæ³„éœ²
- å…¶ä»–äººå¯èƒ½æ»¥ç”¨æ‚¨çš„APIé¢åº¦

**å»ºè®®ä¿®å¤**ï¼š
1. å°†é»˜è®¤API Keyæ”¹ä¸ºç©ºå­—ç¬¦ä¸²
2. æˆ–ä½¿ç”¨ç¯å¢ƒå˜é‡
3. æˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­è¯»å–

```python
'api_key': '',  # ç”¨æˆ·è‡ªå·±é…ç½®
```

---

### Bug #4ï¼šCohen's dé™¤é›¶é£é™©ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

**ä½ç½®**ï¼š`src/lib/stat_functions.py` ç¬¬31è¡Œ
```python
cohens_d = (group1.mean() - group2.mean()) / pooled_std
```

**é—®é¢˜**ï¼š
- å½“ä¸¤ç»„æ•°æ®å®Œå…¨ç›¸åŒä¸”æ ‡å‡†å·®ä¸º0æ—¶ï¼Œpooled_std=0ï¼Œé™¤é›¶é”™è¯¯

**å»ºè®®ä¿®å¤**ï¼š
```python
if pooled_std == 0:
    cohens_d = 0.0  # æˆ– float('inf')
else:
    cohens_d = (group1.mean() - group2.mean()) / pooled_std
```

---

### Bug #5ï¼šsession_stateæœªåˆå§‹åŒ–è®¿é—®ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

**ä½ç½®**ï¼šå¤šå¤„ä½¿ç”¨ `st.session_state.value_labels`ã€`st.session_state.manual_values` ç­‰

**é—®é¢˜**ï¼š
- è¿™äº›keyåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æœªåˆå§‹åŒ–
- ä¼šå¯¼è‡´KeyError

**å½“å‰çŠ¶æ€**ï¼š
- `variable_labels.py` ä¸­æœ‰ `init_value_labels()` å‡½æ•°
- ä½†ä¸æ˜¯æ‰€æœ‰åœ°æ–¹éƒ½è°ƒç”¨äº†

**å»ºè®®ä¿®å¤**ï¼š
åœ¨ `app.py` ä¸­åˆå§‹åŒ–æ‰€æœ‰å¿…éœ€çš„session_stateï¼š
```python
if 'value_labels' not in st.session_state:
    st.session_state.value_labels = {}
if 'manual_values' not in st.session_state:
    st.session_state.manual_values = {}
if 'variable_labels' not in st.session_state:
    st.session_state.variable_labels = {}
```

---

### Bug #6ï¼šç»˜å›¾è§†å›¾æ•°æ®è®¿é—®ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

**ä½ç½®**ï¼š`src/components/plot_view.py` ç¬¬219-220è¡Œ
```python
start_val = float(y_data.iloc[0])
end_val = float(y_data.iloc[-1])
```

**é—®é¢˜**ï¼š
- è™½ç„¶å‰é¢æœ‰ `if len(y_data) == 0: continue`
- ä½†å¦‚æœ `len(y_data) == 1`ï¼Œ`iloc[-1]` å’Œ `iloc[0]` ç›¸åŒï¼Œå¯èƒ½å¯¼è‡´é€»è¾‘é”™è¯¯

**å»ºè®®ä¿®å¤**ï¼š
```python
if len(y_data) < 2:
    continue
```

---

### âœ… Bug #7ï¼šç›¸å…³åˆ†ææ ·æœ¬é‡æ£€æŸ¥ä¸ä¸¥æ ¼ï¼ˆå·²ä¿®å¤ï¼‰

**ä½ç½®**ï¼š`src/lib/stat_functions.py` ç¬¬250-256è¡Œ

**é—®é¢˜**ï¼š
- è®¡ç®—ç›¸å…³ç³»æ•°æ—¶ï¼Œ`n - 2` ä¼šç”¨äºè‡ªç”±åº¦
- å¦‚æœ `n = 2`ï¼Œè‡ªç”±åº¦ä¸º0ï¼Œç»Ÿè®¡æ£€éªŒæ— æ„ä¹‰
- åŸä»£ç ä¸­æ²¡æœ‰æ£€æŸ¥æœ€å°æ ·æœ¬é‡

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```python
# è½¬æ¢ä¸ºæ•°å€¼ç±»å‹å¹¶åˆ é™¤ç¼ºå¤±å€¼
data = df[variables].apply(pd.to_numeric, errors='coerce').dropna()
n = len(data)

# æ£€æŸ¥æ ·æœ¬é‡ï¼ˆç›¸å…³åˆ†æè‡³å°‘éœ€è¦3ä¸ªæ•°æ®ç‚¹ï¼‰
if n < 3:
    return {"error": "æœ‰æ•ˆæ•°æ®ç‚¹å¤ªå°‘ï¼Œæ— æ³•è¿›è¡Œç›¸å…³åˆ†æï¼ˆè‡³å°‘éœ€è¦3ä¸ªæœ‰æ•ˆæ•°æ®ç‚¹ï¼‰"}

# ç›¸å…³çŸ©é˜µ
corr_matrix = data.corr()
```

**ä¿®å¤ä½ç½®**ï¼š
- âœ… `src/lib/stat_functions.py` ç¬¬250-259è¡Œï¼ˆå·²ä¿®å¤ï¼‰

**ä¿®å¤æ—¶é—´**ï¼š2025-11-06

**è¯´æ˜**ï¼š`src/components/stat_view.py` ä¸­å·²æœ‰æ­¤æ£€æŸ¥ï¼Œç°åœ¨ç»Ÿä¸€äº†

---

## ğŸ“Š Bugä¿®å¤çŠ¶æ€

### âœ… å·²ä¿®å¤ï¼ˆ2025-11-06ï¼‰
1. âœ… **Bug #1ï¼šé™¤é›¶é”™è¯¯é£é™©** - ç›¸å…³åˆ†æé™¤é›¶ä¿æŠ¤
2. âŒ **Bug #7ï¼šç›¸å…³åˆ†ææ ·æœ¬é‡æ£€æŸ¥** - å·²æ’¤é”€ï¼ˆç”¨æˆ·è¦æ±‚æ¢å¤åŸçŠ¶ï¼‰

### âš ï¸ å¾…ä¿®å¤ï¼ˆå¯é€‰ï¼‰

#### ğŸ”´ é«˜ä¼˜å…ˆçº§
1. **Bug #3ï¼šAPI Keyç¡¬ç¼–ç ** - å®‰å…¨é£é™©ï¼ˆç”¨æˆ·å¯è‡ªè¡Œå†³å®šæ˜¯å¦ä¿®å¤ï¼‰

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§
1. **Bug #2ï¼šç©ºæ•è·å¼‚å¸¸** - å½±å“è°ƒè¯•
2. **Bug #4ï¼šCohen's dé™¤é›¶** - æç«¯æƒ…å†µ
3. **Bug #5ï¼šsession_stateæœªåˆå§‹åŒ–** - å·²æœ‰éƒ¨åˆ†ä¿æŠ¤
4. **Bug #6ï¼šç»˜å›¾æ•°æ®è®¿é—®** - è¾¹ç•Œæƒ…å†µ

---

## ğŸ¯ ä¿®å¤æ€»ç»“

### æœ¬æ¬¡ä¼šè¯ä¿®å¤çš„Bugæ€»æ•°ï¼š9ä¸ª

**å·²ä¿®å¤çš„é‡è¦Bug**ï¼š
1. âœ… æ··åˆç±»å‹æ’åºé”™è¯¯ï¼ˆ5å¤„ï¼‰
2. âœ… AIç¼–é€ æ•°æ®é—®é¢˜
3. âœ… æ ‡ç­¾æ®‹ç•™é—®é¢˜
4. âœ… æç¤ºè¯ç¡¬ç¼–ç ç¤ºä¾‹
5. âœ… å¹´çº§ç±»å‹åˆ¤æ–­é”™è¯¯
6. âœ… AIç¼ºå°‘å­¦æœ¯ä¾æ®
7. âœ… AIç¼ºå°‘æ˜ç¡®ç»“è®º
8. âœ… é™¤é›¶é”™è¯¯é£é™©ï¼ˆ2å¤„ï¼‰
9. âœ… ç›¸å…³åˆ†ææ ·æœ¬é‡æ£€æŸ¥

**å‰©ä½™å¯é€‰Bug**ï¼š5ä¸ªï¼ˆå‡ä¸ºä½é£é™©ï¼‰

---

## ğŸ“ æ€»ç»“

### ä»£ç è´¨é‡è¯„ä¼°
- âœ… æ•´ä½“ç»“æ„è‰¯å¥½
- âœ… å¼‚å¸¸å¤„ç†è¾ƒå®Œå–„
- âœ… æœ¬æ¬¡ä¼šè¯å·²ä¿®å¤**9ä¸ªé‡è¦bug**
- âœ… ç³»ç»Ÿç¨³å®šæ€§æ˜¾è‘—æå‡
- âš ï¸ ä»æœ‰5ä¸ªä½é£é™©bugå¾…å¤„ç†ï¼ˆå¯é€‰ï¼‰

### ç¨³å®šæ€§è¯„ä¼°
- **å½“å‰çŠ¶æ€**ï¼šåŠŸèƒ½ç¨³å®šå¯é 
- **å·²è§£å†³çš„é£é™©**ï¼š
  - âœ… é™¤é›¶é”™è¯¯ï¼ˆç›¸å…³åˆ†æï¼‰
  - âœ… æ ·æœ¬é‡ä¸è¶³ï¼ˆç»Ÿè®¡æ£€éªŒï¼‰
  - âœ… æ··åˆç±»å‹æ’åº
  - âœ… AIæ•°æ®ç¼–é€ 
  - âœ… æ ‡ç­¾æ®‹ç•™
- **å‰©ä½™é£é™©**ï¼š
  - âš ï¸ API Keyç¡¬ç¼–ç ï¼ˆå¯ç”±ç”¨æˆ·è‡ªè¡Œå†³å®šï¼‰
  - ğŸŸ¢ å…¶ä»–ä½é£é™©bugï¼ˆå½±å“æå°ï¼‰

### æµ‹è¯•å»ºè®®
ä¿®å¤åè¯·æµ‹è¯•ï¼š
1. âœ… ç›¸å…³åˆ†æï¼ˆç‰¹åˆ«æ˜¯å®Œå…¨ç›¸å…³çš„æƒ…å†µï¼‰
2. âœ… å°æ ·æœ¬æ•°æ®çš„ç»Ÿè®¡åˆ†æ
3. âœ… æ··åˆç±»å‹å˜é‡çš„ç»Ÿè®¡

---

## âœ… ä¿®å¤å®Œæˆé€šçŸ¥

**Bug #1ï¼ˆé™¤é›¶é”™è¯¯ï¼‰** å’Œ **Bug #7ï¼ˆæ ·æœ¬é‡æ£€æŸ¥ï¼‰** å·²æˆåŠŸä¿®å¤ï¼

**ä¿®å¤å†…å®¹**ï¼š
- âœ… æ·»åŠ äº†å®Œå…¨ç›¸å…³æƒ…å†µçš„ä¿æŠ¤ï¼ˆrâ‰¥0.9999ï¼‰
- âœ… æ·»åŠ äº†æœ€å°æ ·æœ¬é‡æ£€æŸ¥ï¼ˆnâ‰¥3ï¼‰
- âœ… æ”¹è¿›äº†æ•°æ®é¢„å¤„ç†æµç¨‹

**å½±å“**ï¼š
- âœ… å®Œå…¨ä¸å½±å“æ­£å¸¸æ“ä½œ
- âœ… æé«˜ç³»ç»Ÿç¨³å®šæ€§
- âœ… é˜²æ­¢æç«¯æƒ…å†µå´©æºƒ

**å¦‚ä½•ç”Ÿæ•ˆ**ï¼š
åˆ·æ–°æµè§ˆå™¨å³å¯ï¼ˆStreamlitè‡ªåŠ¨æ£€æµ‹ä»£ç æ›´æ”¹ï¼‰

