"""帮助页面模块：小白也能看懂的使用指南"""
import streamlit as st
from src.lib.i18n import get_lang

def render_help_view():
    lang = get_lang()
    
    # 标题行和快捷按钮
    col1, col2, col3 = st.columns([2.0, 2.2, 0.4])
    with col1:
        title = "❓ 新手指南" if lang == 'zh' else "❓ гарын авлага"
        st.title(title)
        caption = "👋 别担心，跟着做就行！" if lang == 'zh' else "👋 Санаа зовох хэрэггүй, дагаад л хий!"
        st.caption(caption)
    with col2:
        # 快捷按钮组
        btn_col1, btn_col2, btn_col3 = st.columns(3)
        with btn_col1:
            btn_text = "📁 数据" if lang == 'zh' else "📁 Өгөгдөл"
            btn_help = "跳转到数据视图" if lang == 'zh' else "Өгөгдлийн харах руу шилжих"
            if st.button(btn_text, help=btn_help, use_container_width=True):
                st.session_state.current_page = "data"
                st.rerun()
        with btn_col2:
            btn_text = "📈 绘图" if lang == 'zh' else "📈 График"
            btn_help = "跳转到绘图视图" if lang == 'zh' else "График харах руу шилжих"
            if st.button(btn_text, help=btn_help, use_container_width=True):
                st.session_state.current_page = "plot"
                st.rerun()
        with btn_col3:
            btn_help = "跳转到AI辅助分析" if lang == 'zh' else "AI туслах шинжилгээ рүү шилжих"
            if st.button("🤖 AI", help=btn_help, use_container_width=True):
                st.session_state.current_page = "ai"
                st.rerun()
    with col3:
        pass  # 帮助页面不需要帮助按钮
    
    st.markdown("---")
    
    # 目录导航
    section_title = "## 📚 我想学..." if lang == 'zh' else "## 📚 Би сурахыг хүсч байна..."
    st.markdown(section_title)
    
    col1, col2, col3 = st.columns(3)
    with col1:
        btn_text = "📥 怎么导入数据" if lang == 'zh' else "📥 Өгөгдөл яаж оруулах вэ"
        if st.button(btn_text, use_container_width=True, type="secondary"):
            st.session_state.help_section = "import"
            st.rerun()
    with col2:
        btn_text = "🤖 怎么用AI分析" if lang == 'zh' else "🤖 AI-г яаж ашиглах вэ"
        if st.button(btn_text, use_container_width=True, type="secondary"):
            st.session_state.help_section = "ai"
            st.rerun()
    with col3:
        btn_text = "📊 看懂统计结果" if lang == 'zh' else "📊 Статистикийн үр дүнг ойлгох"
        if st.button(btn_text, use_container_width=True, type="secondary"):
            st.session_state.help_section = "stats"
            st.rerun()
    
    st.markdown("---")
    
    # 根据选择显示不同的帮助内容
    if 'help_section' not in st.session_state:
        st.session_state.help_section = "overview"
    
    section = st.session_state.help_section
    
    # ========== 概览 ==========
    if section == "overview":
        if lang == 'zh':
            st.markdown("## 🎯 三步学会用 AIStats")
            st.success("✨ 想象一下：你有一堆数据（比如调查问卷），想知道有什么规律，AIStats 就是帮你分析的工具！")
            st.markdown("### 1️⃣ 第一步：把数据传上来")
            st.markdown("""
**就像发微信传文件一样简单**
- 点左边的 `📁 数据视图`
- 点 `选择数据文件` 上传你的Excel或CSV文件
- 或者点 `📥 加载示例数据`

💡 **小提示**：不知道用什么数据？先点"加载示例数据"试试！
            """)
        else:
            st.markdown("## 🎯 Гурван алхамаар AIStats-ийг сурах")
            st.success("✨ Төсөөлөөрэй：Танд олон өгөгдөл (жишээ нь судалгааны асуулга) байгаа, ямар хандлага байгааг мэдэхийг хүсч байна, AIStats бол танд шинжилгээ хийхэд туслах хэрэгсэл!")
            st.markdown("### 1️⃣ Нэгдүгээр алхам: Өгөгдлийг байршуулах")
            st.markdown("""
**WeChat-аар файл илгээх шиг амархан**
- Зүүн талын `📁 Өгөгдөл харах` дарах
- `Өгөгдлийн файл сонгох` дарж Excel эсвэл CSV файл байршуулах
- Эсвэл `📥 Жишээ өгөгдөл ачаалах` дарах

💡 **Зөвлөмж**：Ямар өгөгдөл ашиглахаа мэдэхгүй байна уу? Эхлээд "Жишээ өгөгдөл ачаалах" дарж үзээрэй!
            """)
        
        st.markdown("---")
        
        # 第二步
        if lang == 'zh':
            st.markdown("### 2️⃣ 第二步：跟AI聊天，让它帮你分析")
            st.markdown("""
**就像问朋友问题一样**
- 点左边的 `🤖 AI 辅助分析`
- 在对话框里直接问，比如：
  - "这些数据是什么意思？"
  - "男生和女生的成绩有差别吗？"
  - "这两个变量有关系吗？"

💡 **小提示**：不会问？往下看，有常用问题示例！
            """)
        else:
            st.markdown("### 2️⃣ Хоёрдугаар алхам: AI-тай ярилцаж, шинжилгээ хийлгэх")
            st.markdown("""
**Найзтайгаа яриулах шиг**
- Зүүн талын `🤖 AI туслах шинжилгээ` дарах
- Харилцах цонхонд шууд асуу, жишээ нь:
  - "Эдгээр өгөгдөл юу гэсэн үг вэ?"
  - "Эрэгтэй, эмэгтэй сурагчдын дүнд ялгаа байна уу?"
  - "Энэ хоёр хувьсагч хамааралтай юу?"

💡 **Зөвлөмж**：Яаж асуухаа мэдэхгүй байна уу? Доош үзээрэй, бий болгох асуултын жишээ байна!
            """)
        
        st.markdown("---")
        
        # 第三步
        if lang == 'zh':
            st.markdown("### 3️⃣ 第三步：看结果、看图表")
            st.markdown("""
**AI会告诉你结论，还会建议画什么图**
- AI分析完会显示表格和结论
- 它会告诉你"有差异"还是"没差异"
- 想看图的话，跟着AI的建议去 `📈 绘图视图` 画图

💡 **小提示**：看不懂表格？没关系，看AI写的文字就行！
            """)
        else:
            st.markdown("### 3️⃣ Гуравдугаар алхам: Үр дүн, график үзэх")
            st.markdown("""
**AI танд дүгнэлт өгөх бөгөөд ямар график зурахыг зөвлөнө**
- AI шинжилгээ хийсний дараа хүснэгт болон дүгнэлт харуулна
- "Ялгаа байна" эсвэл "ялгаа байхгүй" гэж хэлнэ
- График харахыг хүсвэл AI-ийн зөвлөмжийн дагуу `📈 График харах` руу очиж зураарай

💡 **Зөвлөмж**：Хүснэгт ойлгохгүй байна уу? Санаа зовох хэрэггүй, AI-ийн бичсэн текстийг үзээрэй!
            """)
        
        st.markdown("---")
        section_title = "### ⚡ 常见情景" if lang == 'zh' else "### ⚡ Түгээмэл нөхцөл"
        st.markdown(section_title)
        
        if lang == 'zh':
            with st.expander("📝 **我做了问卷调查，想分析数据**"):
                st.markdown("""
1. 把问卷数据整理成Excel（每列是一个问题，每行是一个人）
2. 导入到AIStats
3. 跟AI说："这是我的问卷数据，帮我看看有什么发现"
4. AI会自动帮你分析并给建议
                """)
            
            with st.expander("📈 **我想知道两组人有没有差别**（比如男女、有无监督）"):
                st.markdown("""
直接问AI："XX（比如：父母监督）对YY（比如：作业完成率）有影响吗？"

AI会自动做统计检验，告诉你"有影响"还是"没影响"。
                """)
            
            with st.expander("🔗 **我想知道两个东西有没有关系**（比如身高和体重）"):
                st.markdown("""
直接问AI："XX和YY有关系吗？"

AI会告诉你它们是不是相关，是正相关还是负相关。
                """)
            
            with st.expander("📊 **我想画图展示数据**"):
                st.markdown("""
先问AI："这个结果适合画什么图？"

AI会告诉你用什么图，然后你去 `📈 绘图视图` 按它说的画就行。
                """)
        else:
            with st.expander("📝 **Би судалгааны асуулга хийсэн, өгөгдөл шинжилмээр байна**"):
                st.markdown("""
1. Асуулгын өгөгдлийг Excel-ээр эмхэтгэх (баганa бүр асуулт, мөр бүр нэг хүн)
2. AIStats руу оруулах
3. AI-д хэл: "Энэ миний асуулгын өгөгдөл, юу олж харахад туслаарай"
4. AI автоматаар шинжилж зөвлөгөө өгнө
                """)
            
            with st.expander("📈 **Хоёр бүлгийн хүмүүсийн ялгааг мэдмээр байна**（Жишээ нь эрэгтэй-эмэгтэй）"):
                st.markdown("""
AI-д шууд асуу: "XX (жишээ нь: эцэг эхийн хяналт) YY (жишээ нь: даалгавар гүйцэтгэлт)-д нөлөөтэй юу?"

AI автоматаар статистик шалгалт хийж "нөлөөтэй" эсвэл "нөлөөгүй" гэж хэлнэ.
                """)
            
            with st.expander("🔗 **Хоёр зүйл хамааралтай эсэхийг мэдмээр байна**（Жишээ нь өндөр ба жин）"):
                st.markdown("""
AI-д шууд асуу: "XX ба YY хамааралтай юу?"

AI тэд хамааралтай эсэх, эерэг хамаарал эсвэл сөрөг хамаарал гэж хэлнэ.
                """)
            
            with st.expander("📊 **График зурж өгөгдлийг харуулмаар байна**"):
                st.markdown("""
Эхлээд AI-д асуу: "Энэ үр дүнд ямар график тохирох вэ?"

AI ямар график ашиглахыг хэлнэ, дараа нь `📈 График харах` руу очиж түүний хэлсний дагуу зураарай.
                """)
    
    # ========== 数据导入 ==========
    elif section == "import":
        if lang == 'zh':
            st.markdown("## 📥 怎么把数据传上来？")
            st.info("💡 **简单来说**：就像往微信里发文件一样，把Excel或CSV文件传上来就行！")
            st.markdown("### 📌 你的数据应该长这样")
            st.markdown("""
想象一张Excel表格：
- **第一行**是问题（比如：姓名、性别、年龄、成绩）
- **每一列**代表一个问题
- **每一行**代表一个人

**举个例子：**
            """)
            data_example = {
                "姓名": ["小明", "小红", "小刚"],
                "性别": ["男", "女", "男"],
                "年龄": [18, 19, 18],
                "成绩": [85, 92, 78]
            }
            st.table(data_example)
            st.success("✅ 这样的数据就可以直接用！")
            st.markdown("---")
            st.markdown("### 📤 两种导入方法")
            col1, col2 = st.columns(2)
            with col1:
                st.markdown("#### 方法 1：先试试示例数据")
                st.markdown("""
**适合新手**

1. 点左边的 `📁 数据视图`
2. 找到 `📥 加载示例数据` 按钮
3. 点一下，数据就进来了！

🎯 这样你就可以先体验一下怎么用AI分析数据
                """)
            with col2:
                st.markdown("#### 方法 2：上传自己的数据")
                st.markdown("""
**准备好自己的数据了**

1. 点左边的 `📁 数据视图`
2. 点 `选择数据文件`
3. 找到你电脑里的Excel或CSV文件
4. 选中，点打开

🎯 支持 `.xlsx`、`.xls`、`.csv` 格式
                """)
            st.markdown("---")
            st.markdown("### ❓ 常见问题")
            with st.expander("**我的Excel有好几个工作表，怎么办？**"):
                st.markdown("建议把要分析的数据复制到第一个工作表，或者另存为CSV文件。")
            with st.expander("**导入后数据乱码了怎么办？**"):
                st.markdown("可能是编码问题。在Excel里选择「另存为」→ `CSV UTF-8 (逗号分隔)` 格式。")
            with st.expander("**导入后提示错误怎么办？**"):
                st.markdown("检查：第一行是不是列名、有没有合并的单元格、文件格式是不是Excel或CSV。")
        else:
            st.markdown("## 📥 Өгөгдлийг яаж байршуулах вэ?")
            st.info("💡 **Хялбараар хэлэхэд**：WeChat-руу файл илгээх шиг Excel буюу CSV файл байршуулаарай!")
            st.markdown("### 📌 Таны өгөгдөл ийм байх ёстой")
            st.markdown("""
Excel хүснэгтийг төсөөлөөрэй：
- **Эхний мөр** нь асуулт (жишээ нь: нэр, хүйс, нас, оноо)
- **Багана бүр** нь асуултыг төлөөлнө
- **Мөр бүр** нь нэг хүнийг төлөөлнө

**Жишээ：**
            """)
            data_example = {
                "Нэр": ["Батаа", "Сараа", "Болд"],
                "Хүйс": ["Эр", "Эм", "Эр"],
                "Нас": [18, 19, 18],
                "Оноо": [85, 92, 78]
            }
            st.table(data_example)
            st.success("✅ Ийм өгөгдлийг шууд ашиглаж болно!")
            st.markdown("---")
            st.markdown("### 📤 Хоёр аргаар оруулах")
            col1, col2 = st.columns(2)
            with col1:
                st.markdown("#### Арга 1: Эхлээд жишээ өгөгдөл туршаарай")
                st.markdown("""
**Эхлэгчдэд тохиромжтой**

1. Зүүн талын `📁 Өгөгдөл харах` дарах
2. `📥 Жишээ өгөгдөл ачаалах` товчийг олох
3. Нэг дарахад өгөгдөл орж ирнэ!

🎯 Ингэснээр AI-аар өгөгдөл шинжлэх арга туршиж болно
                """)
            with col2:
                st.markdown("#### Арга 2: Өөрийн өгөгдлийг байршуулах")
                st.markdown("""
**Өөрийн өгөгдөл бэлэн болсон**

1. Зүүн талын `📁 Өгөгдөл харах` дарах
2. `Өгөгдлийн файл сонгох` дарах
3. Компьютер дээрээс Excel эсвэл CSV файл олох
4. Сонгоод, нээх дарах

🎯 `.xlsx`、`.xls`、`.csv` форматыг дэмжинэ
                """)
            st.markdown("---")
            st.markdown("### ❓ Түгээмэл асуултууд")
            with st.expander("**Миний Excel-д хэд хэдэн хуудас байгаа, яах вэ?**"):
                st.markdown("Шинжилэх өгөгдлийг эхний хуудас руу хуулах, эсвэл CSV файлаар хадгалахыг зөвлөж байна.")
            with st.expander("**Оруулсны дараа өгөгдөл эвдэрсэн байвал яах вэ?**"):
                st.markdown("Кодчиллын асуудал байж магадгүй. Excel-ээс 'Хадгалах' → `CSV UTF-8` формат сонгоорой.")
            with st.expander("**Оруулах үед алдаа гарвал яах вэ?**"):
                st.markdown("Шалгах: эхний мөр баганы нэр мөн үү, нүд нэгтгэсэн байна уу, файлын формат Excel эсвэл CSV мөн үү.")
    
    # ========== AI 分析 ==========
    elif section == "ai":
        if lang == 'zh':
            st.markdown("## 🤖 怎么用AI分析数据？")
            st.info("💡 **简单来说**：就像跟朋友聊天一样，直接问问题，AI会帮你分析并解释结果！")
            st.markdown("### 🔧 第一步：配置AI（只需要做一次）")
            st.warning("⚠️ **重要**：AIStats本身不提供AI服务，需要你自己申请一个API Key（就像钥匙一样）")
            st.markdown("#### 推荐用 DeepSeek（便宜又好用）")
        else:
            st.markdown("## 🤖 AI-аар өгөгдөл яаж шинжлэх вэ?")
            st.info("💡 **Хялбараар хэлэхэд**：Найзтайгаа ярилцах шиг, шууд асуулт асуу, AI танд шинжилж үр дүнг тайлбарлана!")
            st.markdown("### 🔧 Нэгдүгээр алхам: AI тохируулах (зөвхөн нэг удаа)")
            st.warning("⚠️ **Чухал**：AIStats өөрөө AI үйлчилгээ хангадаггүй, та өөрөө API Key авах хэрэгтэй")
            st.markdown("#### DeepSeek ашиглахыг зөвлөж байна (хямд, сайн)")
        
        if lang == 'zh':
            st.markdown("""
**价格参考**：一块钱能用很久很久（比你想象的便宜得多）

**怎么获取API Key：**

1. **打开网站**：在浏览器输入 `https://platform.deepseek.com`
2. **注册账号**：点"注册"，用手机号或邮箱注册，1分钟搞定
3. **充值**：充个10块钱就能用很久，支持微信/支付宝
4. **创建API Key**：登录后点"API Keys" → 点"创建API Key" → 复制显示的字符（只显示一次）
5. **在AIStats里配置**：去 `🤖 AI 辅助分析` 页面 → 展开 `⚙️ AI 配置` → 粘贴Key → 勾选"开启 AI 辅助分析" → 点"保存配置"

🎉 **配置好了！以后就不用再设置了**
            """)
        else:
            st.markdown("""
**Үнийн жишээ**：Нэг юань удаан ашиглаж болно (таны төсөөлсниөс хямд)

**API Key яаж авах：**

1. **Вэбсайт нээх**：Браузерт `https://platform.deepseek.com` оруулах
2. **Бүртгүүлэх**：Утасны дугаар эсвэл имэйлээр бүртгүүлэх, 1 минут
3. **Цэнэглэх**：10 юань цэнэглэвэл удаан ашиглаж болно
4. **API Key үүсгэх**：Нэвтэрсний дараа "API Keys" → "API Key үүсгэх" → Үзүүлсэн тэмдэгтийг хуулах (зөвхөн нэг удаа)
5. **AIStats-д тохируулах**：`🤖 AI туслах шинжилгээ` → `⚙️ AI тохиргоо` → Key оруулах → "AI-г идэвхжүүлэх" → "Хадгалах"

🎉 **Тохиргоо хийгдлээ! Дахин тохируулах шаардлагагүй**
            """)
        
        st.markdown("---")
        
        if lang == 'zh':
            st.markdown("### 💬 第二步：开始问问题")
            st.success("✨ 配置好后，就可以像聊天一样跟AI对话了！")
            st.markdown("#### 🌟 常用问题模板（直接复制用）")
            with st.expander("📊 **想知道数据基本情况**", expanded=True):
                st.code("这个数据集有多少人？有哪些变量？")
                st.code("帮我看看作业完成率的平均值和最大最小值")
                st.code("数据里有没有什么特别的地方？")
            with st.expander("🔍 **想比较两组人有没有差别**"):
                st.markdown("**比如：男生女生、有监督vs无监督、参加培训vs没参加**")
                st.code("父母监督对作业完成率有影响吗？")
                st.code("男生和女生的成绩有差别吗？")
            with st.expander("🔗 **想知道两个东西有没有关系**"):
                st.markdown("**比如：身高和体重、学习时间和成绩**")
                st.code("作业完成率和学习成绩有关系吗？")
                st.code("学习时长跟成绩是正相关还是负相关？")
            with st.expander("� **想画图展示**"):
                st.code("这个结果适合用什么图展示？")
                st.code("怎么画图能看出父母监督的影响？")
        else:
            st.markdown("### 💬 Хоёрдугаар алхам: Асуулт эхлүүлэх")
            st.success("✨ Тохиргоо хийсний дараа ярилцах шиг AI-тай ярилцаж болно!")
            st.markdown("#### 🌟 Түгээмэл асуултын загвар (шууд хуулж ашиглаарай)")
            with st.expander("📊 **Өгөгдлийн ерөнхий байдлыг мэдэх**", expanded=True):
                st.code("Энэ өгөгдөлд хэдэн хүн байна? Ямар хувьсагчид байна?")
                st.code("Даалгавар гүйцэтгэлтийн дундаж, хамгийн их, хамгийн бага утгыг харуулаарай")
                st.code("Өгөгдөлд онцгой зүйл байна уу?")
            with st.expander("🔍 **Хоёр бүлгийн ялгааг мэдэх**"):
                st.markdown("**Жишээ нь: эрэгтэй-эмэгтэй, хяналттай-хяналтгүй**")
                st.code("Эцэг эхийн хяналт даалгавар гүйцэтгэлтэд нөлөөтэй юу?")
                st.code("Эрэгтэй, эмэгтэй хүмүүсийн дүн ялгаатай юу?")
            with st.expander("� **Хоёр зүйлийн хамаарлыг мэдэх**"):
                st.markdown("**Жишээ нь: өндөр ба жин, сурах хугацаа ба дүн**")
                st.code("Даалгавар гүйцэтгэлт ба сурлагын дүн хамааралтай юу?")
                st.code("Сурах хугацаа ба дүн эерэг хамаарал уу сөрөг хамаарал уу?")
            with st.expander("📈 **График зурах**"):
                st.code("Энэ үр дүнд ямар график тохирох вэ?")
                st.code("Эцэг эхийн хяналтын нөлөөг яаж графикаар харуулах вэ?")
        
        st.markdown("---")
        
        if lang == 'zh':
            st.markdown("### 📋 第三步：看懂AI的回复")
            st.markdown("""
AI会给你三种东西：

#### 1. **统计表格**（看起来专业）
- 有数字、有符号（如 `***`、`**`、`*`）
- **重点看**：`p值` 这一列
  - `p < 0.05` 并且有星号 `*` → 说明**有显著差异**或**有显著关系**
  - `p > 0.05` 没星号 → 说明**没显著差异**或**没显著关系**

#### 2. **文字解释**（看这个最简单）
- 蓝色背景的框里是**重点结论**
- AI用大白话告诉你结果
- **不用看表格，看这里就够了！**

#### 3. **画图建议**（可选）
- 如果想画图，AI会告诉你画什么图、X轴Y轴放什么
            """)
        else:
            st.markdown("### 📋 Гуравдугаар алхам: AI-ийн хариуг ойлгох")
            st.markdown("""
AI танд гурван зүйл өгнө：

#### 1. **Статистик хүснэгт**（мэргэжлийн харагдана）
- Тоо, тэмдэг байна（жишээ нь `***`、`**`、`*`）
- **Голлох үзэх**：`p утга` энэ баганыг
  - `p < 0.05` од `*` байвал → **мэдэгдэхүйц ялгаа** эсвэл **хамаарал байна**
  - `p > 0.05` од байхгүй → **мэдэгдэхүйц ялгаа** эсвэл **хамаарал байхгүй**

#### 2. **Текст тайлбар**（энийг үзэхэд хамгийн хялбар）
- Цэнхэр дэвсгэртэй хайрцагт **гол дүгнэлт** байна
- AI энгийн үгээр үр дүнг хэлнэ
- **Хүснэгт үзэх шаардлагагүй, энийг үзэхэд хангалттай！**

#### 3. **График зөвлөмж**（сонголттой）
- График зурахыг хүсвэл AI ямар график, X Y тэнхлэгт юу тавихыг хэлнэ
            """)
        
        st.markdown("---")
        
        if lang == 'zh':
            st.markdown("### ❓ 常见问题")
            with st.expander("**AI说'请先导入数据'是什么意思？**"):
                st.markdown("说明你还没有把数据传上来。点左边的 `📁 数据视图` → 上传文件或加载示例数据 → 回到 `🤖 AI 辅助分析` 再问一次")
            with st.expander("**AI没有回复或报错了怎么办？**"):
                st.markdown("可能的原因：1. API Key没配置或配置错了 → 重新检查一遍；2. 网络问题 → 刷新页面重试；3. API余额不足 → 去DeepSeek平台充值")
            with st.expander("**AI的回答看不懂怎么办？**"):
                st.markdown("再问一次：「能解释得更简单一点吗？」或者「这个结果是什么意思？能举个例子吗？」AI会用更简单的语言再解释一遍。")
        else:
            st.markdown("### ❓ Түгээмэл асуултууд")
            with st.expander("**AI 'эхлээд өгөгдөл оруулна уу' гэж хэлвэл юу гэсэн үг вэ?**"):
                st.markdown("Та өгөгдөл оруулаагүй байна гэсэн үг. `📁 Өгөгдөл харах` → файл байршуулах эсвэл жишээ өгөгдөл ачаалах → `🤖 AI туслах шинжилгээ` руу буцаж дахин асуух")
            with st.expander("**AI хариулахгүй байна эсвэл алдаа гарвал яах вэ?**"):
                st.markdown("Боломжит шалтгаан：1. API Key тохируулаагүй эсвэл буруу → дахин шалгах；2. Сүлжээний асуудал → хуудсыг шинэчлэх；3. API үлдэгдэл хүрэлцэхгүй → DeepSeek платформд цэнэглэх")
            with st.expander("**AI-ийн хариуг ойлгохгүй байвал яах вэ?**"):
                st.markdown("Дахин асуу: 'Илүү энгийнээр тайлбарлаж өгөөч?' эсвэл 'Энэ үр дүн юу гэсэн үг вэ? Жишээ өгөөч?' AI илүү энгийн үгээр дахин тайлбарлана.")
    
    # ========== 统计结果 ==========
    elif section == "stats":
        if lang == 'zh':
            st.markdown("## 📊 怎么看懂统计结果？")
            st.info("💡 **简单来说**：不用看懂所有数字，只要能看懂结论就行！")
            st.markdown("### 🎯 最重要的一个概念：p值")
            st.success("""
**p值 就像是"可信度指标"**

- 如果 `p < 0.05` 而且有星号 `*` → 说明**结果可信**，差异是真的存在的
- 如果 `p > 0.05` 没有星号 → 说明**结果不够可信**，差异可能是碰巧出现的

**记住**：**p越小越好**！p<0.05就算过关了
            """)
        else:
            st.markdown("## 📊 Статистикийн үр дүнг яаж ойлгох вэ?")
            st.info("💡 **Хялбараар хэлэхэд**：Бүх тоог ойлгох шаардлагагүй, зөвхөн дүгнэлтийг ойлгоорой!")
            st.markdown("### 🎯 Хамгийн чухал ойлголт: p утга")
            st.success("""
**p утга бол "итгэлийн үзүүлэлт" шиг зүйл**

- `p < 0.05` од `*` байвал → **үр дүн итгэмжтэй**, ялгаа үнэхээр байна
- `p > 0.05` од байхгүй → **үр дүн тийм итгэмжтэй биш**, ялгаа санамсаргүй байж магадгүй

**Санаарай**：**p бага байх тусам сайн**！p<0.05 бол тэнцсэн гэсэн үг
            """)
        
        st.markdown("---")
        
        if lang == 'zh':
            st.markdown("### 📌 常见的结果类型")
            with st.expander("1️⃣ **比较两组人（比如男女、有无监督）**", expanded=True):
                st.markdown("""
这叫 "t检验"，不过你不需要记这个名字。

**看什么？** 看 `p值` 那一列，看 `显著性` 那一列（有星号 `*` 就是显著）

**怎么理解？** p < 0.05 → 两组确实有差别；p > 0.05 → 两组差别不大（可能是碰巧）
                """)
            with st.expander("2️⃣ **看两个东西有没有关系（比如身高和体重）**"):
                st.markdown("""
这叫 "相关分析"，也不用记名字。

**相关系数 r**：r > 0 正相关；r < 0 负相关；|r| > 0.5 关系强；|r| < 0.3 关系弱

**p值**：p < 0.05 → 这个关系是真的；p > 0.05 → 这个关系可能是巧合
                """)
            with st.expander("3️⃣ **看星号（显著性标记）**"):
                st.markdown("""
**星号越多越可信**：`***` 非常可信(p<0.001)；`**` 很可信(p<0.01)；`*` 可信(p<0.05)；`ns` 不显著(p≥0.05)
                """)
        else:
            st.markdown("### 📌 Түгээмэл үр дүнгийн төрөл")
            with st.expander("1️⃣ **Хоёр бүлгийг харьцуулах（жишээ нь эрэгтэй-эмэгтэй）**", expanded=True):
                st.markdown("""
Үүнийг "t шалгалт" гэж нэрлэдэг, гэхдээ санах шаардлагагүй.

**Юу харах вэ？** `p утга` баганыг, `Ач холбогдол` баганыг（од `*` байвал ач холбогдолтой）

**Яаж ойлгох вэ？** p < 0.05 → хоёр бүлэг үнэхээр ялгаатай；p > 0.05 → ялгаа тийм их биш（санамсаргүй байж магадгүй）
                """)
            with st.expander("2️⃣ **Хоёр зүйлийн хамаарлыг харах（жишээ нь өндөр ба жин）**"):
                st.markdown("""
Үүнийг "корреляци шинжилгээ" гэж нэрлэдэг, санах шаардлагагүй.

**Корреляцийн коэффициент r**：r > 0 эерэг хамаарал；r < 0 сөрөг хамаарал；|r| > 0.5 хүчтэй хамаарал；|r| < 0.3 сул хамаарал

**p утга**：p < 0.05 → энэ хамаарал үнэн；p > 0.05 → энэ хамаарал санамсаргүй байж магадгүй
                """)
            with st.expander("3️⃣ **Од（ач холбогдлын тэмдэг）**"):
                st.markdown("""
**Од олон байх тусам итгэмжтэй**：`***` маш итгэмжтэй(p<0.001)；`**` итгэмжтэй(p<0.01)；`*` итгэмжтэй(p<0.05)；`ns` ач холбогдолгүй(p≥0.05)
                """)
        
        st.markdown("---")
        
        if lang == 'zh':
            st.markdown("### 💡 实用建议")
            st.markdown("""
1. **不用记公式和名词** - 知道怎么看结果就行
2. **重点看两个东西** - `p值`（越小越好）和星号（越多越好）
3. **看不懂就问AI** - 让AI用大白话解释一遍
4. **多看几次就熟了** - 用多了自然就懂了
            """)
        else:
            st.markdown("### 💡 Бодит зөвлөмж")
            st.markdown("""
1. **Томьёо, нэр санах шаардлагагүй** - Үр дүнг яаж харахыг мэдэхэд хангалттай
2. **Хоёр зүйлд анхаарах** - `p утга`（бага байх тусам сайн）ба од（олон байх тусам сайн）
3. **Ойлгохгүй бол AI-с асуу** - AI энгийн үгээр тайлбарлана
4. **Олон удаа үзээд дасна** - Олон хэрэглэхэд аяндаа ойлгоно
            """)
        
        st.markdown("---")
        
        if lang == 'zh':
            st.markdown("### 🎓 写论文/报告的话...")
            with st.expander("**怎么把结果写进论文？**"):
                st.markdown("""
**模板1：比较两组**  
经过独立样本t检验，父母监督对作业完成率有显著影响（t=8.23, p<0.001）。有监督组的平均完成率为95.0%，显著高于无监督组的63.0%。

**模板2：相关关系**  
相关分析显示，作业完成率与学习成绩呈显著正相关（r=0.856, p<0.001），即作业完成率越高，学习成绩越好。
                """)
        else:
            st.markdown("### 🎓 Өгүүлэл, тайлан бичих бол...")
            with st.expander("**Үр дүнг өгүүлэлд яаж бичих вэ?**"):
                st.markdown("""
**Загвар 1：Хоёр бүлгийг харьцуулах**  
Бие даасан түүврийн t шалгалтаар эцэг эхийн хяналт даалгавар гүйцэтгэлтэд мэдэгдэхүйц нөлөөтэй（t=8.23, p<0.001）. Хяналттай бүлгийн дундаж 95.0%, хяналтгүй бүлгийн 63.0%-иас мэдэгдэхүйц өндөр.

**Загвар 2：Корреляци хамаарал**  
Корреляци шинжилгээгээр даалгавар гүйцэтгэлт ба сурлагын дүн мэдэгдэхүйц эерэг хамааралтай（r=0.856, p<0.001），өөрөөр хэлбэл даалгавар гүйцэтгэлт өндөр байх тусам дүн сайн.
                """)
    
    st.markdown("---")
    
    # 底部快捷按钮
    title = "### 🚀 准备好了吗？开始用吧！" if lang == 'zh' else "### 🚀 Бэлэн үү? Эхлүүлье!"
    st.markdown(title)
    col1, col2, col3 = st.columns(3)
    with col1:
        btn_text = "📁 去导入数据" if lang == 'zh' else "📁 Өгөгдөл оруулах"
        if st.button(btn_text, use_container_width=True, type="primary"):
            st.session_state.current_page = "data"
            st.rerun()
    with col2:
        btn_text = "🤖 去AI分析" if lang == 'zh' else "🤖 AI шинжилгээ хийх"
        if st.button(btn_text, use_container_width=True, type="primary"):
            st.session_state.current_page = "ai"
            st.rerun()
    with col3:
        btn_text = "📈 去画图" if lang == 'zh' else "📈 График зурах"
        if st.button(btn_text, use_container_width=True, type="primary"):
            st.session_state.current_page = "plot"
            st.rerun()
