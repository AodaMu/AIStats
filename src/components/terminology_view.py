"""术语解释页面 - 统计术语详解"""
import streamlit as st
import pandas as pd
import numpy as np
import plotly.graph_objects as go
import plotly.express as px
from scipy import stats
from src.lib.i18n import get_lang

def render_terminology_view():
    """渲染术语解释页面"""
    lang = get_lang()
    
    col1, col2, col3 = st.columns([2.0, 2.2, 0.4])
    with col1:
        title = "📚 术语解释" if lang == 'zh' else "📚 Нэр томъёоны тайлбар"
        st.title(title)
    with col2:
        btn_col1, btn_col2, btn_col3 = st.columns(3)
        with btn_col1:
            btn_text = "📊 统计" if lang == 'zh' else "📊 Статистик"
            if st.button(btn_text, use_container_width=True):
                st.session_state.current_page = "stat"
                st.rerun()
        with btn_col2:
            btn_text = "📈 绘图" if lang == 'zh' else "📈 График"
            if st.button(btn_text, use_container_width=True):
                st.session_state.current_page = "plot"
                st.rerun()
        with btn_col3:
            if st.button("🤖 AI", use_container_width=True):
                st.session_state.current_page = "ai"
                st.rerun()
    with col3:
        if st.button("❓", use_container_width=True, type="secondary"):
            st.session_state.current_page = "help"
            st.rerun()
    
    st.markdown("---")
    
    if lang == 'zh':
        tabs = ["📊 描述统计", "🔬 假设检验", "🔗 相关与回归", "📈 图表类型", "🎯 高级分析"]
    else:
        tabs = ["📊 Тайлбарлах статистик", "🔬 Таамаглал шалгах", "🔗 Хамаарал ба регресс", "📈 Графикийн төрөл", "🎯 Дэвшилтэт шинжилгээ"]
    
    tab1, tab2, tab3, tab4, tab5 = st.tabs(tabs)
    
    # ==================== 标签1：描述统计 ====================
    with tab1:
        header = "📊 描述统计术语" if lang == 'zh' else "📊 Тайлбарлах статистикийн нэр томъёо"
        st.header(header)
        
        # 辅助函数：根据语言分割双语文本
        def get_text(bilingual_text):
            """从 'CN / MN' 或 'CN：...MN：...' 格式中提取对应语言的文本"""
            text = str(bilingual_text)
            
            # 处理简单的 ' / ' 分隔格式（单行）
            if ' / ' in text and '\n' not in text:
                parts = text.split(' / ')
                return parts[0] if lang == 'zh' else parts[1] if len(parts) > 1 else parts[0]
            
            # 处理多行 CN：...MN：... 格式
            # 支持 CN：和 CN: 两种冒号格式
            cn_markers = ['CN：', 'CN:']
            mn_markers = ['MN：', 'MN:']
            
            cn_start = -1
            mn_start = -1
            
            for marker in cn_markers:
                if marker in text:
                    cn_start = text.find(marker) + len(marker)
                    break
            
            for marker in mn_markers:
                if marker in text:
                    mn_start = text.find(marker)
                    break
            
            if cn_start > 0 or mn_start >= 0:
                if lang == 'zh':
                    if cn_start > 0:
                        end = mn_start if mn_start > cn_start else len(text)
                        return text[cn_start:end].strip()
                else:
                    if mn_start >= 0:
                        for marker in mn_markers:
                            if marker in text:
                                return text[mn_start + len(marker):].strip()
            
            return text
        
        terms_1 = {
            "均值 / Дундаж": {
                "definition": "衡量数据离散程度的指标，值越大数据波动越大，说明数据分布越分散 / Өгөгдлийн тарах хэмжээг хэмжих үзүүлэлт, утга их байх тусам өгөгдлийн хэлбэлзэл их байна",
                "formula": "SD = √[Σ(xᵢ - Mean)² / n]",
                "example": """
CN：班级A成绩：78, 79, 80, 81, 82（紧凑）
班级B成绩：60, 70, 80, 90, 100（分散）

班级A的标准差 ≈ 1.4分
班级B的标准差 ≈ 15.8分

解释：
- B班标准差大 → 成绩波动大 → 学生水平差异大
- A班标准差小 → 成绩波动小 → 学生水平比较接近

MN：A анги оноо: 78, 79, 80, 81, 82 (нягт)
B анги оноо: 60, 70, 80, 90, 100 (сарнисан)

A ангийн стандарт хазайлт ≈ 1.4 оноо
B ангийн стандарт хазайлт ≈ 15.8 оноо

Тайлбар:
- B анги стандарт хазайлт их → оноо их хэлбэлзэнэ → сурагчдын түвшин ялгаатай
- A анги стандарт хазайлт бага → оноо бага хэлбэлзэнэ → сурагчдын түвшин ойролцоо"""
            },
            "中位数 / Медиан": {
                "definition": "排序后位于中间的数值，也称50%分位数，不受极端值影响 / Эрэмбэлсэний дараа дундуур байрлах утга, 50% квартиль гэж нэрлэгддэг, туйлын утгаас нөлөөлөгддөггүй",
                "formula": "排序后的中间值（奇数个）或中间两个数的平均值（偶数个） / Эрэмбэлсэний дараа дундах утга (сондгой тоо) эсвэл дундах хоёр утгын дундаж (тэгш тоо)",
                "example": """
CN：例子1：奇数个数据
数据：10, 20, 30, 40, 50
排序后中位数 = 30（第3个）

例子2：偶数个数据
数据：10, 20, 30, 40
排序后中位数 = (20 + 30) / 2 = 25

应用：
- 不受极端值影响
- 适合有离群值的数据

MN：Жишээ 1: Сондгой тооны өгөгдөл
Өгөгдөл: 10, 20, 30, 40, 50
Эрэмбэлсэний дараа медиан = 30 (3-р)

Жишээ 2: Тэгш тооны өгөгдөл
Өгөгдөл: 10, 20, 30, 40
Эрэмбэлсэний дараа медиан = (20 + 30) / 2 = 25

Хэрэглээ:
- Туйлын утгаас нөлөөлөгддөггүй
- Гадаадын утгатай өгөгдөлд тохиромжтой"""
            },
            "Q1 / Нэгдүгээр квартиль": {
                "definition": "25%分位数，表示25%的数据小于此值，也称第一四分位数 / 25% квартиль, 25% өгөгдөл энэ утгаас бага байна гэсэн үг",
                "formula": "排序后第25%位置的值 / Эрэмбэлсэний дараа 25% байрлалын утга",
                "example": """
CN：100个学生成绩排序后：
Q1 = 70分

解释：
- 25个学生成绩 ≤ 70分
- 75个学生成绩 > 70分
- 表示成绩较低的学生的分界线

MN：100 сурагчийн оноо эрэмбэлсэний дараа:
Q1 = 70 оноо

Тайлбар:
- 25 сурагчийн оноо ≤ 70 оноо
- 75 сурагчийн оноо > 70 оноо
- Бага оноотой сурагчдын хилийг илэрхийлнэ"""
            },
            "Q3 / Гуравдугаар квартиль": {
                "definition": "75%分位数，表示75%的数据小于此值，也称第三四分位数 / 75% квартиль, 75% өгөгдөл энэ утгаас бага байна гэсэн үг",
                "formula": "排序后第75%位置的值 / Эрэмбэлсэний дараа 75% байрлалын утга",
                "example": """
CN：100个学生成绩排序后：
Q3 = 85分

解释：
- 75个学生成绩 ≤ 85分
- 25个学生成绩 > 85分
- 表示成绩较高的学生的分界线

四分位数范围（IQR）= Q3 - Q1 = 85 - 70 = 15分

MN：100 сурагчийн оноо эрэмбэлсэний дараа:
Q3 = 85 оноо

Тайлбар:
- 75 сурагчийн оноо ≤ 85 оноо
- 25 сурагчийн оноо > 85 оноо
- Өндөр оноотой сурагчдын хилийг илэрхийлнэ

Квартиль хүрээ (IQR) = Q3 - Q1 = 85 - 70 = 15 оноо"""
            },
            "最大值 / Хамгийн их утга": {
                "definition": "数据中的最大数值，表示数据的上界 / Өгөгдлийн хамгийн их утга, өгөгдлийн дээд хилийг илэрхийлнэ",
                "formula": "max(x₁, x₂, ..., xₙ)",
                "example": """
CN：班级成绩：60, 70, 80, 90, 100
最大值 = 100分

应用：
- 了解数据的上限
- 检测异常值
- 与最小值一起确定数据范围

MN：Ангийн оноо: 60, 70, 80, 90, 100
Хамгийн их утга = 100 оноо

Хэрэглээ:
- Өгөгдлийн дээд хилийг мэдэх
- Гадаадын утгыг илрүүлэх
- Хамгийн бага утгатай хамт өгөгдлийн хүрээг тодорхойлох"""
            },
            "最小值 / Хамгийн бага утга": {
                "definition": "数据中的最小数值，表示数据的下界 / Өгөгдлийн хамгийн бага утга, өгөгдлийн доод хилийг илэрхийлнэ",
                "formula": "min(x₁, x₂, ..., xₙ)",
                "example": """
CN：班级成绩：60, 70, 80, 90, 100
最小值 = 60分

数据范围 = 最大值 - 最小值 = 100 - 60 = 40分

应用：
- 了解数据的下限
- 检测异常值
- 评估数据的跨度

MN：Ангийн оноо: 60, 70, 80, 90, 100
Хамгийн бага утга = 60 оноо

Өгөгдлийн хүрээ = Хамгийн их утга - Хамгийн бага утга = 100 - 60 = 40 оноо

Хэрэглээ:
- Өгөгдлийн доод хилийг мэдэх
- Гадаадын утгыг илрүүлэх
- Өгөгдлийн хүрээг үнэлэх"""
            }
        }
        
        for term_name, term_info in terms_1.items():
            col_left, col_right = st.columns([1, 2])
            
            with col_left:
                st.markdown(f"### 📌 {get_text(term_name)}")
                def_label = "**定义：**" if lang == 'zh' else "**Тодорхойлолт：**"
                st.markdown(f"{def_label}  \n{get_text(term_info['definition'])}")
            
            with col_right:
                formula_label = "**公式：**" if lang == 'zh' else "**Томьёо：**"
                st.markdown(f"{formula_label}  \n`{get_text(term_info['formula'])}`")
                example_label = "**例子：**" if lang == 'zh' else "**Жишээ：**"
                st.markdown(f"{example_label}  \n{get_text(term_info['example'])}")
            
            st.markdown("---")
        
        subheader = "📊 可视化示例" if lang == 'zh' else "📊 Дүрслэлийн жишээ"
        st.subheader(subheader)
        np.random.seed(42)
        data = np.random.normal(75, 15, 100)
        
        col1, col2 = st.columns(2)
        with col1:
            title = "**直方图 - 数据分布**" if lang == 'zh' else "**Гистограмм - Өгөгдлийн тархалт**"
            st.markdown(title)
            fig = go.Figure(data=[go.Histogram(x=data, nbinsx=20)])
            fig.add_vline(x=np.mean(data), line_dash="dash", line_color="red")
            x_title = "成绩" if lang == 'zh' else "Оноо"
            y_title = "频数" if lang == 'zh' else "Давтамж"
            fig.update_layout(height=350, xaxis_title=x_title, yaxis_title=y_title)
            st.plotly_chart(fig, use_container_width=True)
            if lang == 'zh':
                st.caption(f"均值: {np.mean(data):.2f} | 标准差: {np.std(data):.2f}")
                st.info("""
**📖 图表解读：**
- **柱高** = 该分数区间的学生人数
- **红色虚线** = 平均分(75分)
- **分布形态** = 钟形曲线，说明数据呈正态分布
                """)
            else:
                st.caption(f"Дундаж: {np.mean(data):.2f} | Стандарт хазайлт: {np.std(data):.2f}")
                st.info("""
**📖 Графикийн тайлбар：**
- **Баганы өндөр** = Тухайн оноон дахь сурагчдын тоо
- **Улаан тасархай шугам** = Дундаж оноо (75 оноо)
- **Тархалтын хэлбэр** = Хонхны хэлбэртэй муруй, өгөгдөл хэвийн тархалттай
                """)
        
        with col2:
            title = "**箱线图 - 四分位数**" if lang == 'zh' else "**Хайрцаг график - Дөрөвний нэг**"
            st.markdown(title)
            fig = go.Figure(data=[go.Box(y=data)])
            y_title = "成绩" if lang == 'zh' else "Оноо"
            fig.update_layout(height=350, yaxis_title=y_title)
            st.plotly_chart(fig, use_container_width=True)
            q1, q2, q3 = np.percentile(data, [25, 50, 75])
            if lang == 'zh':
                st.caption(f"Q1={q1:.1f} | 中位数={q2:.1f} | Q3={q3:.1f}")
                st.info("""
**📖 图表解读：**
- **箱体** = 中间50%的数据范围
- **中间线** = 中位数(第50百分位)
- **须(上下线)** = 数据的最大最小范围
- **圆点** = 异常值(离群点)
                """)
            else:
                st.caption(f"Q1={q1:.1f} | Медиан={q2:.1f} | Q3={q3:.1f}")
                st.info("""
**📖 Графикийн тайлбар：**
- **Хайрцаг** = Дундаж 50%-ийн өгөгдлийн хүрээ
- **Дунд шугам** = Медиан (50-р хувь)
- **Сахал (дээд доод шугам)** = Өгөгдлийн хамгийн их ба бага утга
- **Цэг** = Хэвийн бус утга
                """)
    
    # ==================== 标签2：假设检验 ====================
    with tab2:
        header = "🔬 假设检验术语" if lang == 'zh' else "🔬 Таамаглал шалгах нэр томъёо"
        st.header(header)
        
        terms_2 = {
            "P值 / P утга": {
                "definition": "概率值，表示在原假设为真的情况下，观察到当前数据或更极端数据的概率 / Анхны таамаглал үнэн байх үед одоогийн өгөгдөл эсвэл илүү экстремал өгөгдлийг ажиглах магадлал",
                "formula": "P < 0.05：有统计显著性 | P ≥ 0.05：无统计显著性 / P < 0.05：Статистикийн ач холбогдолтой | P ≥ 0.05：Ач холбогдолгүй",
                "example": """
CN：计算步骤示例：比较两个班级的平均成绩

- A班：10个学生，平均成绩80分，标准差5分
- B班：10个学生，平均成绩75分，标准差6分

计算t值
t = (Mean_A - Mean_B) / SE = (80 - 75) / √(5²/10 + 6²/10) = 5 / 2.2 ≈ 2.27

确定自由度
df = n_A + n_B - 2 = 10 + 10 - 2 = 18

查t分布表或用软件计算
根据t=2.27和df=18，查表得到 P ≈ 0.035

判断显著性
P = 0.035 < 0.05 → 两班成绩有显著差异**

MN：Тооцооны алхам жишээ: Хоёр ангийн дундаж оноог харьцуулах

- A анги: 10 сурагч, дундаж оноо 80 оноо, стандарт хазайлт 5 оноо
- B анги: 10 сурагч, дундаж оноо 75 оноо, стандарт хазайлт 6 оноо

t утгыг тооцоолох
t = (Mean_A - Mean_B) / SE = (80 - 75) / √(5²/10 + 6²/10) = 5 / 2.2 ≈ 2.27

Чөлөөний зэргийг тодорхойлох
df = n_A + n_B - 2 = 10 + 10 - 2 = 18

t хүснэгтийг хайх эсвэл программ ашиглах
t=2.27 ба df=18 дээр үндэслэн хүснэгтээс P ≈ 0.035 авна

Значимость шалгах
P = 0.035 < 0.05 → Хоёр ангийн оноо ялгаатай **
"""
            },
            "t值 / t утга": {
                "definition": "t检验的统计量，用来衡量两组数据均值差异的大小 / t шалгалтын статистик хэмжигдэхүүн, хоёр бүлгийн өгөгдлийн дундаж утгын ялгааг хэмжихэд ашигладаг",
                "formula": "t = (Mean₁ - Mean₂) / SE，其中SE = √(SD₁²/n₁ + SD₂²/n₂) / t = (Mean₁ - Mean₂) / SE，SE = √(SD₁²/n₁ + SD₂²/n₂)",
                "example": """
CN：班级A：平均80分，标准差5分，20个学生
班级B：平均75分，标准差6分，25个学生

计算SE = √(5²/20 + 6²/25) = √(1.25 + 1.44) = √2.69 ≈ 1.64
计算t = (80 - 75) / 1.64 ≈ 3.05

|t|值越大 → 差异越明显
t = 3.05表示差异很大

MN：A анги: дундаж 80 оноо, стандарт хазайлт 5 оноо, 20 сурагч
B анги: дундаж 75 оноо, стандарт хазайлт 6 оноо, 25 сурагч

SE-г тооцоолох = √(5²/20 + 6²/25) = √(1.25 + 1.44) = √2.69 ≈ 1.64
t-г тооцоолох = (80 - 75) / 1.64 ≈ 3.05

|t| утга их байх тусам → ялгаа их байна
t = 3.05 нь ялгаа маш их гэсэн үг"""
            },
            "显著性 / Ач холбогдол": {
                "definition": "用星号标记结果的显著性水平，表示结果的可信度 / Одны тэмдгээр үр дүнгийн ач холбогдлын түвшинг тэмдэглэж, үр дүнгийн найдвартай байдлыг илэрхийлнэ",
                "formula": "*** p<0.001 | ** p<0.01 | * p<0.05 | ns 不显著 / *** p<0.001 | ** p<0.01 | * p<0.05 | ns Ач холбогдолгүй",
                "example": """
CN：结果显示：t=2.5, p=0.008**

解释：
- ** 表示p<0.01
- 说明有99%的把握认为两组有显著差异
- 只有1%的概率是由随机误差造成的

MN：Үр дүн харуулж байна: t=2.5, p=0.008**

Тайлбар:
- ** нь p<0.01 гэсэн үг
- 99% итгэлийн түвшинд хоёр бүлгийн ялгаа ач холбогдолтой гэж хэлж болно
- Зөвхөн 1% магадлалтай санамсаргүй алдаа байж болно"""
            },
            "自由度 / Чөлөөний зэрэг": {
                "definition": "数据中可以自由变化的数据个数，影响t分布的形状 / Өгөгдлийн чөлөөтэй өөрчлөгдөж болох өгөгдлийн тоо, t хуваарилалтын хэлбэрт нөлөөлнө",
                "formula": "df = n - 1 (单样本) 或 df = n₁ + n₂ - 2 (两样本) / df = n - 1 (нэг түүвэр) эсвэл df = n₁ + n₂ - 2 (хоёр түүвэр)",
                "example": """
CN：例子1：单样本t检验
样本量n=30 → df = 30 - 1 = 29

例子2：独立样本t检验
班级A：n₁=20，班级B：n₂=25
df = 20 + 25 - 2 = 43

自由度越大 → t分布越接近正态分布

MN：Жишээ 1: Нэг түүврийн t шалгалт
Түүврийн хэмжээ n=30 → df = 30 - 1 = 29

Жишээ 2: Бие даасан түүврийн t шалгалт
A анги: n₁=20, B анги: n₂=25
df = 20 + 25 - 2 = 43

Чөлөөний зэрэг их байх тусам → t хуваарилалт нормаль хуваарилалтад ойр байна"""
            },
            "置信区间 / Итгэлийн интервал": {
                "definition": "一个范围，我们有一定把握（通常95%）认为真实参数在这个范围内 / Нэг хүрээ, бид тодорхой итгэлийн түвшинд (ихэвчлэн 95%) жинхэнэ параметр энэ хүрээнд байна гэж үзнэ",
                "formula": "CI = Mean ± 1.96 × SE（95%置信水平） / CI = Mean ± 1.96 × SE (95% итгэлийн түвшин)",
                "example": """
CN：班级平均成绩80分，标准误差2分

95% CI = 80 ± 1.96 × 2 = 80 ± 3.92 = [76.08, 83.92]

解释：
- 真实平均成绩有95%的概率在76.08-83.92分之间
- 如果重复抽样100次，约95次的置信区间会包含真实值

MN：Ангийн дундаж оноо 80 оноо, стандарт алдаа 2 оноо

95% CI = 80 ± 1.96 × 2 = 80 ± 3.92 = [76.08, 83.92]

Тайлбар:
- Жинхэнэ дундаж оноо 95% магадлалтай 76.08-83.92 оноо хооронд байна
- Хэрэв 100 удаа дахин түүвэрлэвэл, ойролцоогоор 95 удаа итгэлийн интервал жинхэнэ утгыг агуулна"""
            },
            "效应量 / Нөлөөний хэмжээ": {
                "definition": "衡量两组差异的实际大小，不受样本量影响，比P值更能反映差异的实际意义 / Хоёр бүлгийн ялгааны бодит хэмжээг хэмжих, түүврийн хэмжээнээс нөлөөлөгддөггүй, P утгаас илүү ялгааны бодит утгыг илэрхийлнэ",
                "formula": "Cohen's d = (Mean₁ - Mean₂) / 合并标准差 / Cohen's d = (Mean₁ - Mean₂) / нэгдсэн стандарт хазайлт",
                "example": """
CN：班级A平均80分，班级B平均75分，合并SD=10

Cohen's d = (80 - 75) / 10 = 0.5

解释：
- d = 0.5表示中等效应
- 即使P值不显著，差异也可能有实际意义
- 效应量反映的是差异的实际大小

MN：A анги дундаж 80 оноо, B анги дундаж 75 оноо, нэгдсэн SD=10

Cohen's d = (80 - 75) / 10 = 0.5

Тайлбар:
- d = 0.5 нь дунд зэргийн нөлөө гэсэн үг
- P утга ач холбогдолтой биш байсан ч гэсэн ялгаа бодит утгатай байж болно
- Нөлөөний хэмжээ нь ялгааны бодит хэмжээг илэрхийлнэ"""
            },
            "Cohen's d / Cohen's d": {
                "definition": "效应量的标准化指标，用于衡量差异的实际大小，便于不同研究间的比较 / Нөлөөний хэмжээний стандартчилсан үзүүлэлт, ялгааны бодит хэмжээг хэмжихэд ашигладаг, өөр өөр судалгаа хоорондын харьцуулалтыг хөнгөвчилнө",
                "formula": "d = 0.2(小效应) | d = 0.5(中等效应) | d = 0.8(大效应) / d = 0.2(бага нөлөө) | d = 0.5(дунд нөлөө) | d = 0.8(их нөлөө)",
                "example": """
CN：三个研究的效应量对比：

研究1：d = 0.2（小效应）
- 差异存在但很小
- 实际意义有限

研究2：d = 0.5（中等效应）
- 差异明显
- 有一定的实际意义

研究3：d = 0.8（大效应）
- 差异很大
- 实际意义重要

MN：Гурван судалгааны нөлөөний хэмжээний харьцуулалт:

Судалгаа 1: d = 0.2 (жижиг нөлөө)
- Ялгаа байгаа боловч маш бага
- Бодит утга хязгаарлагдмал

Судалгаа 2: d = 0.5 (дунд зэргийн нөлөө)
- Ялгаа тодорхой
- Тодорхой бодит утгатай

Судалгаа 3: d = 0.8 (их нөлөө)
- Ялгаа маш их
- Бодит утга чухал"""
            }
        }
        
        for term_name, term_info in terms_2.items():
            col_left, col_right = st.columns([1, 2])
            
            with col_left:
                st.markdown(f"### 📌 {get_text(term_name)}")
                def_label = "**定义：**" if lang == 'zh' else "**Тодорхойлолт：**"
                st.markdown(f"{def_label}  \n{get_text(term_info['definition'])}")
            
            with col_right:
                std_label = "**标准：**" if lang == 'zh' else "**Стандарт：**"
                st.markdown(f"{std_label}  \n`{get_text(term_info['formula'])}`")
                example_label = "**例子：**" if lang == 'zh' else "**Жишээ：**"
                st.markdown(f"{example_label}  \n{get_text(term_info['example'])}")
            
            st.markdown("---")
        
        subheader = "📊 可视化示例" if lang == 'zh' else "📊 Дүрслэлийн жишээ"
        st.subheader(subheader)
        col1, col2 = st.columns(2)
        
        with col1:
            title = "**t分布与P值**" if lang == 'zh' else "**t тархалт ба P утга**"
            st.markdown(title)
            x = np.linspace(-4, 4, 1000)
            y = stats.t.pdf(x, df=30)
            fig = go.Figure()
            t_name = 't分布' if lang == 'zh' else 't тархалт'
            fig.add_trace(go.Scatter(x=x, y=y, mode='lines', name=t_name, line=dict(color='blue')))
            # 左尾显著区域 (t < -1.96)
            x_left = x[x < -1.96]
            y_left = stats.t.pdf(x_left, df=30)
            sig_name = 'p<0.05 (显著)' if lang == 'zh' else 'p<0.05 (Ач холбогдолтой)'
            fig.add_trace(go.Scatter(x=x_left, y=y_left, fill='tozeroy', name=sig_name, line=dict(color='red'), fillcolor='rgba(255,0,0,0.3)'))
            # 右尾显著区域 (t > 1.96)
            x_right = x[x > 1.96]
            y_right = stats.t.pdf(x_right, df=30)
            fig.add_trace(go.Scatter(x=x_right, y=y_right, fill='tozeroy', showlegend=False, line=dict(color='red'), fillcolor='rgba(255,0,0,0.3)'))
            x_title = "t值" if lang == 'zh' else "t утга"
            y_title = "概率密度" if lang == 'zh' else "Магадлалын нягтрал"
            fig.update_layout(height=350, xaxis_title=x_title, yaxis_title=y_title)
            st.plotly_chart(fig, use_container_width=True)
            if lang == 'zh':
                st.info("""
**📖 图表解读：**
- **蓝色曲线** = t分布（钟形曲线）
- **红色区域** = 显著性区域(p<0.05)
- 当t值落入红色区域时，结果显著
                """)
            else:
                st.info("""
**📖 Графикийн тайлбар：**
- **Цэнхэр муруй** = t тархалт (хонхны хэлбэртэй)
- **Улаан бүс** = Ач холбогдолтой бүс (p<0.05)
- t утга улаан бүсэд орвол үр дүн ач холбогдолтой
                """)
        
        with col2:
            title = "**两组差异对比**" if lang == 'zh' else "**Хоёр бүлгийн ялгааг харьцуулах**"
            st.markdown(title)
            g1 = np.random.normal(70, 10, 100)
            g2 = np.random.normal(75, 10, 100)
            fig = go.Figure()
            g1_name = '第1组' if lang == 'zh' else '1-р бүлэг'
            g2_name = '第2组' if lang == 'zh' else '2-р бүлэг'
            fig.add_trace(go.Histogram(x=g1, name=g1_name, opacity=0.7, nbinsx=20))
            fig.add_trace(go.Histogram(x=g2, name=g2_name, opacity=0.7, nbinsx=20))
            x_title = "成绩" if lang == 'zh' else "Оноо"
            fig.update_layout(height=350, barmode='overlay', xaxis_title=x_title)
            st.plotly_chart(fig, use_container_width=True)
            if lang == 'zh':
                st.info("""
**📖 图表解读：**
- **两种颜色** = 两个不同组的数据分布
- **重叠部分** = 两组共同的范围
- 重叠越少，差异越大
                """)
            else:
                st.info("""
**📖 Графикийн тайлбар：**
- **Хоёр өнгө** = Хоёр өөр бүлгийн өгөгдлийн тархалт
- **Давхцсан хэсэг** = Хоёр бүлгийн нийтлэг хүрээ
- Давхцал бага байх тусам ялгаа их байна
                """)
    
    # ==================== 标签3：相关与回归 ====================
    with tab3:
        header = "🔗 相关与回归术语" if lang == 'zh' else "🔗 Хамаарал ба регрессийн нэр томъёо"
        st.header(header)
        
        terms_3 = {
            "相关系数(r) / Корреляцийн коэффициент(r)": {
                "definition": "衡量两个变量之间线性关系强度的指标，范围从-1到+1，是最常用的相关性指标 / Хоёр хувьсагчийн хооронд шугаман хамаарлын хүчийг хэмжих үзүүлэлт, -1-ээс +1 хүртэл, хамгийн түгээмэл хамаарлын үзүүлэлт",
                "formula": "r=1(完全正相关) | r=0(无相关) | r=-1(完全负相关) | |r|>0.7(强相关) / r=1(бүрэн эерэг) | r=0(хамааралгүй) | r=-1(бүрэн сөрөг) | |r|>0.7(хүчтэй хамаарал)",
                "example": """
CN：学习时间与成绩的关系：
- 学生A：学习5小时，成绩80分
- 学生B：学习8小时，成绩88分
- 学生C：学习10小时，成绩95分

计算相关系数 r = 0.95

解释：
- r > 0 表示正相关
- r = 0.95接近1 → 关系很强
- 学习时间越多，成绩越高

MN：Сурах хугацаа ба оноог хооронд харилцаа:
- Сурагч A: 5 цаг сурсан, 80 оноо авсан
- Сурагч B: 8 цаг сурсан, 88 оноо авсан
- Сурагч C: 10 цаг сурсан, 95 оноо авсан

Корреляцийн коэффициент тооцоолох r = 0.95

Тайлбар:
- r > 0 нь эерэг хамаарал гэсэн үг
- r = 0.95 нь 1-д ойр → хамаарал маш хүчтэй
- Сурах хугацаа их байх тусам оноо их байна"""
            },
            "相关矩阵 / Корреляцийн матриц": {
                "definition": "多个变量两两之间相关系数的表格，用来快速了解所有变量间的关系 / Олон хувьсагчийн хоорондын корреляцийн коэффициентүүдийн хүснэгт, бүх хувьсагчийн хоорондын хамаарлыг хурдан ойлгоход ашигладаг",
                "formula": "n个变量的相关矩阵是n×n的表格，对角线都是1 / n хувьсагчийн корреляцийн матриц нь n×n хүснэгт, диагональ бүгд 1",
                "example": """
CN：三个变量的相关矩阵：

          成绩  学习时间  出勤率
成绩      1.00   0.85    0.72
学习时间  0.85   1.00    0.68
出勤率    0.72   0.68    1.00

解释：
- 成绩与学习时间的相关系数 = 0.85（强正相关）
- 成绩与出勤率的相关系数 = 0.72（较强正相关）
- 学习时间与出勤率的相关系数 = 0.68（中等正相关）

MN：Гурван хувьсагчийн корреляцийн матриц:

          Оноо  Сурах хугацаа  Ирцийн хувь
Оноо      1.00   0.85          0.72
Сурах хугацаа 0.85 1.00        0.68
Ирцийн хувь   0.72   0.68      1.00

Тайлбар:
- Оноо ба сурах хугацааны корреляцийн коэффициент = 0.85 (хүчтэй эерэг хамаарал)
- Оноо ба ирцийн хувьийн корреляцийн коэффициент = 0.72 (нэлээд хүчтэй эерэг хамаарал)
- Сурах хугацаа ба ирцийн хувьийн корреляцийн коэффициент = 0.68 (дунд зэргийн эерэг хамаарал)"""
            },
            "显著性检验 / Ач холбогдлын шалгалт": {
                "definition": "检验相关系数是否统计显著，即是否真实存在而非随机波动 / Корреляцийн коэффициент статистикийн хувьд ач холбогдолтой эсэх, жинхэнэ байх эсвэл санамсаргүй хэлбэлзэл эсэхийг шалгах",
                "formula": "t = r × √(n-2) / √(1-r²) / t = r × √(n-2) / √(1-r²)",
                "example": """
CN：例子1：强相关且显著
r = 0.85, n = 100
计算 → P = 0.001 < 0.05
结论：相关关系显著

例子2：弱相关且不显著
r = 0.15, n = 30
计算 → P = 0.42 ≥ 0.05
结论：相关关系不显著，可能是随机波动

MN：Жишээ 1: Хүчтэй хамаарал ба ач холбогдолтой
r = 0.85, n = 100
Тооцоолох → P = 0.001 < 0.05
Дүгнэлт: Хамаарал ач холбогдолтой

Жишээ 2: Сул хамаарал ба ач холбогдолгүй
r = 0.15, n = 30
Тооцоолох → P = 0.42 ≥ 0.05
Дүгнэлт: Хамаарал ач холбогдолгүй, санамсаргүй хэлбэлзэл байж болно"""
            },
            "回归方程 / Регрессийн тэгшитгэл": {
                "definition": "用来预测因变量的数学方程，建立自变量与因变量的关系模型 / Хамааралтай хувьсагчийг урьдчилан таамаглахад ашигладаг математик тэгшитгэл, бие даасан хувьсагч ба хамааралтай хувьсагчийн хамаарлын загварыг байгуулна",
                "formula": "Y = a + b×X (一元) 或 Y = a + b₁×X₁ + b₂×X₂ + ... (多元) / Y = a + b×X (нэг хувьсагч) эсвэл Y = a + b₁×X₁ + b₂×X₂ + ... (олон хувьсагч)",
                "example": """
CN：一元回归例子：
成绩 = 20 + 0.8×学习时间

解释：
- a = 20（截距）：不学习时的基础成绩
- b = 0.8（斜率）：每多学习1小时，成绩增加0.8分
- 学习5小时 → 预测成绩 = 20 + 0.8×5 = 24分

多元回归例子：
成绩 = 10 + 0.7×学习时间 + 0.5×出勤率

MN：Нэг хувьсагчийн регрессийн жишээ:
Оноо = 20 + 0.8×Сурах хугацаа

Тайлбар:
- a = 20 (огтлол): сурахгүй байх үед суурь оноо
- b = 0.8 (налуу): нэг цаг илүү сурах бүрт оноо 0.8-аар нэмэгдэнэ
- 5 цаг сурах → урьдчилсан оноо = 20 + 0.8×5 = 24 оноо

Олон хувьсагчийн регрессийн жишээ:
Оноо = 10 + 0.7×Сурах хугацаа + 0.5×Ирцийн хувь"""
            },
            "R² / R²": {
                "definition": "表示回归模型能解释因变量变异的比例，范围0-1，越接近1越好 / Регрессийн загвар хамааралтай хувьсагчийн өөрчлөлтийг тайлбарлаж чаддаг хэмжээг илэрхийлнэ, 0-1 хүртэл, 1-д ойр байх тусам сайн",
                "formula": "R² = 解释的变异 / 总变异 / R² = Тайлбарласан өөрчлөлт / Нийт өөрчлөлт",
                "example": """
CN：预测成绩的回归模型：
R² = 0.65

解释：
- 65%的成绩变异可由学习时间解释
- 35%的成绩变异由其他因素造成
- 模型拟合度良好

R²的判断标准：
- R² > 0.7：拟合度很好
- 0.5 < R² < 0.7：拟合度良好
- R² < 0.5：拟合度一般

MN：Оноог урьдчилан таамаглах регрессийн загвар:
R² = 0.65

Тайлбар:
- Оноогийн өөрчлөлтийн 65% нь сурах хугацаагаар тайлбарлагдана
- Оноогийн өөрчлөлтийн 35% нь бусад хүчин зүйлээр үүсдэг
- Загварын сайн байдал сайн

R²-ийн үнэлэх стандарт:
- R² > 0.7: сайн байдал маш сайн
- 0.5 < R² < 0.7: сайн байдал сайн
- R² < 0.5: сайн байдал дундаж"""
            },
            "调整R² / Тохируулсан R²": {
                "definition": "考虑了自变量个数的R²，用于多元回归，防止变量过多导致R²虚高 / Бие даасан хувьсагчийн тоог харгалзсан R², олон хувьсагчийн регрессид ашигладаг, хувьсагч их байх үед R² хуурамч өндөр болохоос сэргийлнэ",
                "formula": "Adjusted R² = 1 - (1-R²)×(n-1)/(n-p-1)",
                "example": """
CN：多元回归模型对比：

模型1（1个自变量）：
R² = 0.65，Adjusted R² = 0.64

模型2（5个自变量）：
R² = 0.68，Adjusted R² = 0.62

解释：
- 虽然R²增加了，但调整R²反而下降
- 说明增加的变量没有提高模型质量
- 应该选择模型1

MN：Олон хувьсагчийн регрессийн загварын харьцуулалт:

Загвар 1 (1 бие даасан хувьсагч):
R² = 0.65, Тохируулсан R² = 0.64

Загвар 2 (5 бие даасан хувьсагч):
R² = 0.68, Тохируулсан R² = 0.62

Тайлбар:
- R² нэмэгдсэн ч гэсэн тохируулсан R² буурсан
- Нэмсэн хувьсагчид загварын чанарыг сайжруулаагүй гэсэн үг
- Загвар 1-ийг сонгох хэрэгтэй"""
            },
            "VIF / VIF": {
                "definition": "方差膨胀因子，检测多重共线性的指标，表示自变量间的相关程度 / Дисперсийн өргөтгөх хүчин зүйл, олон шугаман хамаарлыг илрүүлэх үзүүлэлт, бие даасан хувьсагчдын хоорондын хамаарлын хэмжээг илэрхийлнэ",
                "formula": "VIF<5：无共线性 | VIF 5-10：可能存在 | VIF>10：严重共线性 / VIF<5：Хамааралгүй | VIF 5-10：Байж болно | VIF>10：Ноцтой хамаарал",
                "example": """
CN：多元回归中三个变量的VIF值：

变量A：VIF = 2.5 ✓ 无共线性
变量B：VIF = 6.8 ⚠️ 可能存在共线性
变量C：VIF = 15.2 ✗ 严重共线性

处理方法：
- 变量A可以保留
- 变量B需要检查
- 变量C应该删除或转换

MN：Олон хувьсагчийн регрессийн гурван хувьсагчийн VIF утга:

Хувьсагч A: VIF = 2.5 ✓ Олон шугаман хамаарал байхгүй
Хувьсагч B: VIF = 6.8 ⚠️ Олон шугаман хамаарал байж болно
Хувьсагч C: VIF = 15.2 ✗ Ноцтой олон шугаман хамаарал

Эмчилгээний арга:
- Хувьсагч A-г хадгалаж болно
- Хувьсагч B-г шалгах хэрэгтэй
- Хувьсагч C-г устгах эсвэл хувиргах хэрэгтэй"""
            }
        }
        
        for term_name, term_info in terms_3.items():
            col_left, col_right = st.columns([1, 2])
            
            with col_left:
                st.markdown(f"### 📌 {get_text(term_name)}")
                def_label = "**定义：**" if lang == 'zh' else "**Тодорхойлолт：**"
                st.markdown(f"{def_label}  \n{get_text(term_info['definition'])}")
            
            with col_right:
                std_label = "**标准：**" if lang == 'zh' else "**Стандарт：**"
                st.markdown(f"{std_label}  \n`{get_text(term_info['formula'])}`")
                example_label = "**例子：**" if lang == 'zh' else "**Жишээ：**"
                st.markdown(f"{example_label}  \n{get_text(term_info['example'])}")
            
            st.markdown("---")
        
        subheader = "📊 可视化示例" if lang == 'zh' else "📊 Дүрслэлийн жишээ"
        st.subheader(subheader)
        col1, col2 = st.columns(2)
        
        with col1:
            title = "**散点图与相关系数**" if lang == 'zh' else "**Цэгэн график ба корреляцийн коэффициент**"
            st.markdown(title)
            np.random.seed(42)
            x = np.random.randn(100)
            y = 0.85 * x + np.random.randn(100) * 0.3
            x_label = '变量X' if lang == 'zh' else 'X хувьсагч'
            y_label = '变量Y' if lang == 'zh' else 'Y хувьсагч'
            fig = px.scatter(x=x, y=y, trendline="ols", labels={'x': x_label, 'y': y_label})
            fig.update_layout(height=350)
            st.plotly_chart(fig, use_container_width=True)
            r = np.corrcoef(x, y)[0, 1]
            if lang == 'zh':
                st.caption(f"相关系数 r = {r:.3f} (强正相关)")
            else:
                st.caption(f"Корреляцийн коэффициент r = {r:.3f} (Хүчтэй эерэг хамаарал)")
            if lang == 'zh':
                st.info("""
**📖 图表解读：**
- **每个点** = 一个样本数据
- **趋势线** = 数据的整体走向
- 点越接近线，相关性越强
                """)
            else:
                st.info("""
**📖 Графикийн тайлбар：**
- **Цэг бүр** = Нэг түүврийн өгөгдөл
- **Чиг хандлагын шугам** = Өгөгдлийн ерөнхий чиглэл
- Цэгүүд шугамд ойр байх тусам хамаарал хүчтэй
                """)
        
        with col2:
            title = "**相关矩阵热力图**" if lang == 'zh' else "**Корреляцийн матрицын дулааны зураг**"
            st.markdown(title)
            data = pd.DataFrame(np.random.randn(100, 4), columns=['A', 'B', 'C', 'D'])
            corr = data.corr()
            fig = go.Figure(data=go.Heatmap(z=corr.values, x=corr.columns, y=corr.columns, 
                                            colorscale='RdBu', zmid=0, zmin=-1, zmax=1))
            fig.update_layout(height=350)
            st.plotly_chart(fig, use_container_width=True)
            if lang == 'zh':
                st.info("""
**📖 图表解读：**
- **红色** = 正相关(r>0)
- **蓝色** = 负相关(r<0)
- **颜色越深** = 相关性越强
- **对角线** = 自己与自己的相关(总是1)
                """)
            else:
                st.info("""
**📖 Графикийн тайлбар：**
- **Улаан** = Эерэг хамаарал (r>0)
- **Цэнхэр** = Сөрөг хамаарал (r<0)
- **Өнгө гүн байх тусам** = Хамаарал хүчтэй
- **Диагональ** = Өөртэйгөө хамаарал (үргэлж 1)
                """)
    
    # ==================== 标签4：图表类型 ====================
    with tab4:
        header = "📈 图表类型详解" if lang == 'zh' else "📈 Графикийн төрлийн дэлгэрэнгүй тайлбар"
        st.header(header)
        
        # 图表类型定义 - 使用函数工厂来捕获lang变量
        def create_bar_chart(l):
            x_labels = ['A班', 'B班', 'C班', 'D班'] if l == 'zh' else ['A анги', 'B анги', 'C анги', 'D анги']
            x_title = "班级" if l == 'zh' else "Анги"
            y_title = "平均成绩" if l == 'zh' else "Дундаж оноо"
            return go.Figure(data=[go.Bar(x=x_labels, y=[75, 82, 78, 85], marker_color=['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728'])]).update_layout(height=300, xaxis_title=x_title, yaxis_title=y_title, showlegend=False)
        
        def create_scatter_chart(l):
            x_label = '学习时间(小时)' if l == 'zh' else 'Сурах хугацаа(цаг)'
            y_label = '考试成绩' if l == 'zh' else 'Шалгалтын оноо'
            return px.scatter(x=np.random.uniform(1, 10, 50), y=50 + 5*np.random.uniform(1, 10, 50) + np.random.normal(0, 5, 50), trendline="ols", labels={'x': x_label, 'y': y_label}, trendline_color_override='red').update_layout(height=300)
        
        def create_line_chart(l):
            months = ['1月', '2月', '3月', '4月', '5月', '6月'] if l == 'zh' else ['1-р сар', '2-р сар', '3-р сар', '4-р сар', '5-р сар', '6-р сар']
            name = '平均成绩' if l == 'zh' else 'Дундаж оноо'
            x_title = "月份" if l == 'zh' else "Сар"
            y_title = "平均成绩" if l == 'zh' else "Дундаж оноо"
            return go.Figure(data=[go.Scatter(x=months, y=[65, 70, 72, 75, 78, 80], mode='lines+markers', name=name, line=dict(color='blue', width=3), marker=dict(size=8))]).update_layout(height=300, xaxis_title=x_title, yaxis_title=y_title)
        
        def create_box_chart(l):
            names = ['A班', 'B班', 'C班', 'D班'] if l == 'zh' else ['A анги', 'B анги', 'C анги', 'D анги']
            y_title = "成绩" if l == 'zh' else "Оноо"
            fig = go.Figure()
            for i in range(4):
                fig.add_trace(go.Box(y=np.random.normal([75, 80, 78, 82][i], [8, 10, 7, 9][i], 50), name=names[i]))
            fig.update_layout(height=300, yaxis_title=y_title)
            return fig
        
        def create_pie_chart(l):
            labels = ['A班\n30人', 'B班\n28人', 'C班\n32人', 'D班\n25人'] if l == 'zh' else ['A анги\n30 хүн', 'B анги\n28 хүн', 'C анги\n32 хүн', 'D анги\n25 хүн']
            return go.Figure(data=[go.Pie(labels=labels, values=[30, 28, 32, 25], textposition='inside', textinfo='label+percent')]).update_layout(height=300)
        
        def create_histogram_chart(l):
            x_title = "成绩" if l == 'zh' else "Оноо"
            y_title = "频数" if l == 'zh' else "Давтамж"
            return go.Figure(data=[go.Histogram(x=np.random.normal(75, 15, 100), nbinsx=20, marker_color='rgba(31, 119, 180, 0.7)')]).update_layout(height=300, xaxis_title=x_title, yaxis_title=y_title)
        
        def create_heatmap_chart(l):
            cols = ['成绩', '学习时间', '出勤率', '作业完成率'] if l == 'zh' else ['Оноо', 'Сурах хугацаа', 'Ирц', 'Гэрийн даалгавар']
            corr = pd.DataFrame(np.random.randn(100, 4), columns=cols).corr()
            return go.Figure(data=go.Heatmap(z=corr.values, x=corr.columns, y=corr.columns, colorscale='RdBu', zmid=0, zmin=-1, zmax=1, text=np.round(corr.values, 2), texttemplate='%{text}', textfont={"size": 10})).update_layout(height=300)
        
        charts_data = [
            {
                "name": "柱状图 / Баганан график",
                "purpose": "CN：比较不同类别的数值大小或频数分布\nMN：Өөр өөр ангиллын утгын хэмжээ эсвэл давтамжийн хуваарилалтыг харьцуулах",
                "when": "CN：分类数据、频数统计、组间比较\nMN：Ангиллын өгөгдөл, давтамжийн статистик, бүлгүүдийн харьцуулалт",
                "example": "CN：不同班级的平均成绩对比\nMN：Өөр өөр ангиудын дундаж оноог харьцуулах",
                "chart_func": lambda: create_bar_chart(lang),
                "tip": "💡 CN：柱状图适合比较不同类别的数值，清晰展示各类别的大小关系\n💡 MN：Баганан график нь өөр өөр ангиллын утгыг харьцуулахад тохиромжтой, ангиллын хэмжээний хамаарлыг тодорхой харуулна"
            },
            {
                "name": "散点图 / Сарнилсан график",
                "purpose": "CN：展示两个变量的关系，识别相关性\nMN：Хоёр хувьсагчийн хамаарлыг харуулах, хамаарлыг тодорхойлох",
                "when": "CN：相关分析、趋势探索、异常值检测\nMN：Хамаарлын анализ, чиг хандлагын судалгаа, хэтийн утгын илрүүлэлт",
                "example": "CN：学习时间与考试成绩的关系\nMN：Сурах хугацаа ба шалгалтын оноог хооронд харилцаа",
                "chart_func": lambda: create_scatter_chart(lang),
                "tip": "💡 CN：散点图能清晰展示两变量的相关关系，红线为趋势线\n💡 MN：Сарнилсан график нь хоёр хувьсагчийн хамаарлыг тодорхой харуулна, улаан шугам нь чиг хандлагын шугам"
            },
            {
                "name": "折线图 / Шугаман график",
                "purpose": "CN：显示数据随时间的变化趋势\nMN：Өгөгдлийн цаг хугацаа дахь өөрчлөлтийн чиг хандлагыг харуулах",
                "when": "CN：时间序列、趋势分析、多变量对比\nMN：Цаг хугацааны цуврал, чиг хандлагын анализ, олон хувьсагчийн харьцуулалт",
                "example": "CN：股票价格或成绩随时间的变化\nMN：Хувьцааны үнэ эсвэл оноо цаг хугацаа дахь өөрчлөлт",
                "chart_func": lambda: create_line_chart(lang),
                "tip": "💡 CN：折线图适合展示时间序列数据的趋势变化\n💡 MN：Шугаман график нь цаг хугацааны цувралын өгөгдлийн чиг хандлагыг харуулахад тохиромжтой"
            },
            {
                "name": "箱线图 / Хайрцаг график",
                "purpose": "CN：展示数据分布、中位数、四分位数\nMN：Өгөгдлийн хуваарилалт, медиан, квартиль харуулах",
                "when": "CN：多组比较、异常值检测、分布分析\nMN：Олон бүлгийн харьцуулалт, хэтийн утгын илрүүлэлт, хуваарилалтын анализ",
                "example": "CN：不同班级学生成绩的分布对比\nMN：Өөр өөр ангиудын сурагчдын оноогийн хуваарилалтыг харьцуулах",
                "chart_func": lambda: create_box_chart(lang),
                "tip": "💡 CN：箱线图显示中位数、四分位数和异常值，适合多组比较\n💡 MN：Хайрцаг график нь медиан, квартиль, хэтийн утгыг харуулна, олон бүлгийн харьцуулалтад тохиромжтой"
            },
            {
                "name": "饼图 / Дугуй график",
                "purpose": "CN：展示各部分占整体的比例\nMN：Хэсэг бүрийн нийтийн эзлэх хувийг харуулах",
                "when": "CN：组成比例、百分比分布\nMN：Бүрэлдэхүүний хувь, хувийн хуваарилалт",
                "example": "CN：各类别产品的销售占比\nMN：Өөр өөр ангиллын бүтээгдэхүүний борлуулалтын эзлэх хувь",
                "chart_func": lambda: create_pie_chart(lang),
                "tip": "💡 CN：饼图适合展示比例关系，但当类别过多时不易比较\n💡 MN：Дугуй график нь хувийн хамаарлыг харуулахад тохиромжтой, гэхдээ ангиллын тоо их байх үед харьцуулалт хэцүү"
            },
            {
                "name": "直方图 / Гистограмм",
                "purpose": "CN：展示连续数据的分布形状\nMN：Тасралтгүй өгөгдлийн хуваарилалтын хэлбэрийг харуулах",
                "when": "CN：正态性检验、分布分析、频数分布\nMN：Нормаль байдлын шалгалт, хуваарилалтын анализ, давтамжийн хуваарилалт",
                "example": "CN：学生成绩的分布情况\nMN：Сурагчдын оноогийн хуваарилалтын нөхцөл",
                "chart_func": lambda: create_histogram_chart(lang),
                "tip": "💡 CN：直方图展示数据分布的形状，可用于检验正态性\n💡 MN：Гистограмм нь өгөгдлийн хуваарилалтын хэлбэрийг харуулна, нормаль байдлыг шалгахад ашиглаж болно"
            },
            {
                "name": "热力图 / Дулаан газрын зураг",
                "purpose": "CN：用颜色表示数值大小，展示矩阵数据\nMN：Өнгөөр утгын хэмжээг илэрхийлэх, матриц өгөгдлийг харуулах",
                "when": "CN：相关矩阵可视化、多变量关系\nMN：Корреляцийн матрицын визуализаци, олон хувьсагчийн хамаарал",
                "example": "CN：变量间相关系数的可视化\nMN：Хувьсагчдын хоорондын корреляцийн коэффициентийн визуализаци",
                "chart_func": lambda: create_heatmap_chart(lang),
                "tip": "💡 CN：热力图用颜色深浅表示相关强度，红色正相关，蓝色负相关\n💡 MN：Дулаан газрын зураг нь өнгөний гүнээр хамаарлын хүчийг илэрхийлнэ, улаан эерэг хамаарал, цэнхэр сөрөг хамаарал"
            }
        ]
        
        # 显示每个图表类型及其对应的可视化
        for idx, chart_info in enumerate(charts_data):
            st.markdown(f"### {idx+1}. {get_text(chart_info['name'])}")
            
            col_left, col_right = st.columns([1, 1.5])
            
            with col_left:
                purpose_label = "**用途：**" if lang == 'zh' else "**Зорилго：**"
                st.markdown(f"{purpose_label}  \n{get_text(chart_info['purpose'])}")
                when_label = "**何时使用：**" if lang == 'zh' else "**Хэзээ ашиглах：**"
                st.markdown(f"{when_label}  \n{get_text(chart_info['when'])}")
                example_label = "**例子：**" if lang == 'zh' else "**Жишээ：**"
                st.markdown(f"{example_label}  \n{get_text(chart_info['example'])}")
            
            with col_right:
                try:
                    fig = chart_info["chart_func"]()
                    st.plotly_chart(fig, use_container_width=True)
                except Exception as e:
                    err_msg = f"图表生成出错: {str(e)}" if lang == 'zh' else f"График үүсгэхэд алдаа: {str(e)}"
                    st.warning(err_msg)
                st.info(get_text(chart_info["tip"]))
            
            st.markdown("---")
    
    # ==================== 标签5：高级分析 ====================
    with tab5:
        header = "🎯 高级分析方法" if lang == 'zh' else "🎯 Дэвшилтэт шинжилгээний арга"
        st.header(header)
        
        terms_5 = {
            "单因素ANOVA / Нэг хүчин зүйлийн ANOVA": {
                "definition": "CN：比较多个组的均值是否存在显著差异\nMN：Олон бүлгийн дундаж утгуудын хооронд ач холбогдолтой ялгаа байгаа эсэхийг харьцуулах",
                "when": "CN：需要比较3个或以上组的均值\nMN：3 ба түүнээс дээш бүлгийн дундаж утгыг харьцуулах шаардлагатай",
                "example": """
CN：比较4个班级的平均成绩：
- A班：n=30, M=75, SD=8
- B班：n=32, M=80, SD=9
- C班：n=28, M=78, SD=7
- D班：n=30, M=82, SD=8

F检验结果：
- F = 5.23, p = 0.002 < 0.05
- 结论：4个班级成绩有显著差异 **

后续分析：
- 进行事后检验（如Tukey HSD）
- 确定哪些班级之间有显著差异

MN：4 ангийн дундаж оноог харьцуулах:
- A анги: n=30, M=75, SD=8
- B анги: n=32, M=80, SD=9
- C анги: n=28, M=78, SD=7
- D анги: n=30, M=82, SD=8

F шалгалтын үр дүн:
- F = 5.23, p = 0.002 < 0.05
- Дүгнэлт: 4 ангийн оноо ач холбогдолтой ялгаатай **

Дараагийн анализ:
- Сүүлийн шалгалт хийх (жишээ нь Tukey HSD)
- Аль ангиудын хооронд ач холбогдолтой ялгаа байгааг тодорхойлох"""
            },
            "Levene检验 / Levene шалгалт": {
                "definition": "CN：检验多个组的方差是否相等（方差齐性检验）\nMN：Олон бүлгийн дисперс тэнцүү эсэхийг шалгах (дисперсийн нэгэнцэгийн шалгалт)",
                "when": "CN：进行ANOVA前检验前提条件\nMN：ANOVA хийхээс өмнө урьдчилсан нөхцөлийг шалгах",
                "example": """
CN：检验4个班级的成绩方差是否相等：

Levene检验结果：
- F = 1.45, p = 0.23 > 0.05
- 结论：方差齐性满足 ✅
- 可以进行标准ANOVA

如果p < 0.05（方差不齐）：
- 需要使用Welch's ANOVA
- 或进行数据转换
- 或使用非参数检验

MN：4 ангийн оноогийн дисперс тэнцүү эсэхийг шалгах:

Levene шалгалтын үр дүн:
- F = 1.45, p = 0.23 > 0.05
- Дүгнэлт: дисперсийн нэгэнцэг хангалтай ✅
- Стандарт ANOVA хийж болно

Хэрэв p < 0.05 (дисперс тэнцүү биш):
- Welch's ANOVA ашиглах шаардлагатай
- Эсвэл өгөгдлийг хувиргах
- Эсвэл параметр бус шалгалт ашиглах"""
            },
            "Cronbach's Alpha / Cronbach's Alpha": {
                "definition": "CN：衡量量表的内部一致性和可靠性\nMN：Хэмжүүрийн дотоод нэгэнцэг ба найдвартай байдлыг хэмжих",
                "when": "CN：评估问卷或量表的信度\nMN：Асуулга эсвэл хэмжүүрийн найдвартай байдлыг үнэлэх",
                "example": """
CN：某心理量表的Cronbach's Alpha = 0.85

解读标准：
- α ≥ 0.9：优秀 ✅ 可用
- 0.8 ≤ α < 0.9：很好 ✅ 可用
- 0.7 ≤ α < 0.8：可接受 ✅ 可用
- 0.6 ≤ α < 0.7：一般 ⚠️ 谨慎使用
- α < 0.6：不可接受 ❌ 不可用

α = 0.85表示：
- 量表的内部一致性很好
- 各题目之间的相关性较强
- 量表可以使用

MN：Нэг сэтгэл судлалын хэмжүүрийн Cronbach's Alpha = 0.85

Тайлбарлах стандарт:
- α ≥ 0.9: маш сайн ✅ ашиглаж болно
- 0.8 ≤ α < 0.9: сайн ✅ ашиглаж болно
- 0.7 ≤ α < 0.8: хүлээн авч болно ✅ ашиглаж болно
- 0.6 ≤ α < 0.7: дундаж ⚠️ сайтар ашиглах
- α < 0.6: хүлээн авч болохгүй ❌ ашиглаж болохгүй

α = 0.85 гэсэн үг:
- Хэмжүүрийн дотоод нэгэнцэг маш сайн
- Асуултуудын хооронд хамаарал хүчтэй
- Хэмжүүр ашиглаж болно"""
            },
            "中介效应 / Завсрын нөлөө": {
                "definition": "CN：研究X通过M对Y的间接影响，包括直接效应和间接效应\nMN：X-ээс M-ээр дамжин Y-д үзүүлэх шууд бус нөлөө, шууд нөлөө ба шууд бус нөлөөг багтаана",
                "when": "CN：探索变量间的作用机制\nMN：Хувьсагчдын хооронд үйлчлэх механизмыг судлах",
                "example": """
CN：模型：学习时间 → 学习效率 → 考试成绩

路径分析结果：
- 直接效应(c') = 0.3 *
- 间接效应(ab) = 0.5 **
- 总效应(c) = 0.8 **

中介效应分析：
- 中介比例 = 0.5 / 0.8 = 62.5%
- 学习效率中介了62.5%的效应
- 说明学习效率是重要的中介机制

结论：
- 学习时间既有直接效应
- 也通过学习效率产生间接效应

MN：Загвар: Сурах хугацаа → Сурах үр ашиг → Шалгалтын оноо

Замын анализын үр дүн:
- Шууд нөлөө(c') = 0.3 *
- Шууд бус нөлөө(ab) = 0.5 **
- Нийт нөлөө(c) = 0.8 **

Завсрын нөлөөний анализ:
- Завсрын хувь = 0.5 / 0.8 = 62.5%
- Сурах үр ашиг 62.5% нөлөөг завсрын үүрэг гүйцэтгэв
- Сурах үр ашиг нь чухал завсрын механизм гэсэн үг

Дүгнэлт:
- Сурах хугацаа шууд нөлөөтэй
- Мөн сурах үр ашигаар дамжин шууд бус нөлөөтэй"""
            },
            "独立样本t检验 / Бие даасан түүврийн t шалгалт": {
                "definition": "CN：比较两个独立组的均值是否显著不同\nMN：Хоёр бие даасан бүлгийн дундаж утгуудын ялгаа ач холбогдолтой эсэхийг харьцуулах",
                "when": "CN：比较两个不同组的平均值\nMN：Хоёр өөр бүлгийн дундаж утгыг харьцуулах",
                "example": """
CN：比较男生和女生的平均成绩：

数据描述：
- 男生：n=50, M=75, SD=8
- 女生：n=50, M=78, SD=9

t检验结果：
- t = -2.15, df = 98
- p = 0.032 < 0.05
- 结论：男生和女生成绩有显著差异 **

效应量：
- Cohen's d = 0.35（小到中等效应）
- 说明差异有统计显著性，但实际差异不大

解释：
- 女生平均成绩比男生高3分
- 这个差异在统计上显著
- 但实际差异较小

MN：Хөвгүүд ба охидын дундаж оноог харьцуулах:

Өгөгдлийн тайлбар:
- Хөвгүүд: n=50, M=75, SD=8
- Охид: n=50, M=78, SD=9

t шалгалтын үр дүн:
- t = -2.15, df = 98
- p = 0.032 < 0.05
- Дүгнэлт: хөвгүүд ба охидын оноо ач холбогдолтой ялгаатай **

Нөлөөний хэмжээ:
- Cohen's d = 0.35 (жижиг дунд нөлөө)
- Ялгаа статистикийн хувьд ач холбогдолтой, гэхдээ бодит ялгаа бага

Тайлбар:
- Охидын дундаж оноо хөвгүүдээс 3 оноо өндөр
- Энэ ялгаа статистикийн хувьд ач холбогдолтой
- Гэхдээ бодит ялгаа бага"""
            },
            "配对样本t检验 / Хосолсон түүврийн t шалгалт": {
                "definition": "CN：比较同一组在两个时间点的均值差异\nMN：Нэг бүлгийн хоёр цаг хугацааны дундаж утгуудын ялгааг харьцуулах",
                "when": "CN：重复测量设计、前后对比\nMN：Давтан хэмжилтийн дизайн, өмнө-дараа харьцуулалт",
                "example": """
CN：学生参加培训前后的成绩对比：

数据描述：
- 培训前：M=70, SD=8
- 培训后：M=75, SD=7
- 差值：M_diff=5, SD_diff=6

配对t检验结果：
- t = 3.25, df = 29
- p = 0.001 < 0.05
- 结论：培训有显著效果 **

效应量：
- Cohen's d = 0.83（大效应）
- 说明培训效果显著

解释：
- 学生培训后成绩提高5分
- 这个提高在统计上显著
- 培训效果明显

MN：Сурагчдын сургалт өмнө-дараа оноог харьцуулах:

Өгөгдлийн тайлбар:
- Сургалтын өмнө: M=70, SD=8
- Сургалтын дараа: M=75, SD=7
- Ялгаа: M_diff=5, SD_diff=6

Хосолсон t шалгалтын үр дүн:
- t = 3.25, df = 29
- p = 0.001 < 0.05
- Дүгнэлт: сургалт ач холбогдолтой үр дүнтэй **

Нөлөөний хэмжээ:
- Cohen's d = 0.83 (их нөлөө)
- Сургалтын үр дүн ач холбогдолтой

Тайлбар:
- Сурагчдын оноо сургалтын дараа 5 оноо нэмэгдсэн
- Энэ өсөлт статистикийн хувьд ач холбогдолтой
- Сургалтын үр дүн тодорхой"""
            },
            "单样本t检验 / Нэг түүврийн t шалгалт": {
                "definition": "CN：检验样本均值是否等于某个特定值\nMN：Түүврийн дундаж утга тодорхой утгатай тэнцүү эсэхийг шалгах",
                "when": "CN：检验样本是否来自特定均值的总体\nMN：Түүвэр тодорхой дундаж утгатай популяциас гарсан эсэхийг шалгах",
                "example": """
CN：检验班级平均成绩是否等于80分：

数据描述：
- 样本：n=30, M=78, SD=10
- 检验值：μ₀ = 80

单样本t检验结果：
- t = -1.10, df = 29
- p = 0.28 > 0.05
- 结论：班级成绩与80分无显著差异

解释：
- 班级平均成绩78分
- 与目标值80分相差2分
- 这个差异不显著
- 班级成绩达到预期水平

MN：Ангийн дундаж оноо 80 оноотой тэнцүү эсэхийг шалгах:

Өгөгдлийн тайлбар:
- Түүвэр: n=30, M=78, SD=10
- Шалгалтын утга: μ₀ = 80

Нэг түүврийн t шалгалтын үр дүн:
- t = -1.10, df = 29
- p = 0.28 > 0.05
- Дүгнэлт: ангийн оноо 80 оноотой ач холбогдолтой ялгаатай биш

Тайлбар:
- Ангийн дундаж оноо 78 оноо
- Зорилтот утга 80 оноотой 2 оноо ялгаатай
- Энэ ялгаа ач холбогдолгүй
- Ангийн оноо хүлээгдэж буй түвшинд хүрсэн"""
            }
        }
        
        for idx, (term, info) in enumerate(terms_5.items(), 1):
            st.markdown(f"### {idx}. {get_text(term)}")
            
            col_left, col_right = st.columns([1, 1.5])
            
            with col_left:
                def_label = "**定义：**" if lang == 'zh' else "**Тодорхойлолт：**"
                st.markdown(f"{def_label}  \n{get_text(info['definition'])}")
                when_label = "**何时使用：**" if lang == 'zh' else "**Хэзээ ашиглах：**"
                st.markdown(f"{when_label}  \n{get_text(info['when'])}")
            
            with col_right:
                example_label = "**例子：**" if lang == 'zh' else "**Жишээ：**"
                st.markdown(f"{example_label}  \n{get_text(info['example'])}")
            
            st.markdown("---")
        
        subheader = "📊 检验方法对比" if lang == 'zh' else "📊 Шалгалтын аргуудын харьцуулалт"
        st.subheader(subheader)
        tip = "**选择合适的检验方法很重要！**" if lang == 'zh' else "**Тохирох шалгалтын аргыг сонгох нь чухал！**"
        st.markdown(tip)
        
        if lang == 'zh':
            comparison_data = {
                '检验方法': ['单样本t检验', '配对样本t检验', '独立样本t检验', '单因素ANOVA'],
                '比较对象': ['样本 vs 总体', '同组前后', '两个独立组', '多个独立组'],
                '样本数': ['1个', '1个（2次测量）', '2个', '3个或以上'],
                '前提条件': ['数据正态', '差值正态', '正态+方差齐', '正态+方差齐'],
                '适用场景': ['检验平均值', '重复测量', '组间比较', '多组比较']
            }
        else:
            comparison_data = {
                'Шалгалтын арга': ['Нэг түүврийн t', 'Хосолсон t', 'Бие даасан t', 'ANOVA'],
                'Харьцуулах зүйл': ['Түүвэр vs Популяци', 'Нэг бүлэг өмнө-дараа', 'Хоёр бие даасан бүлэг', 'Олон бие даасан бүлэг'],
                'Түүврийн тоо': ['1', '1 (2 хэмжилт)', '2', '3+'],
                'Урьдчилсан нөхцөл': ['Хэвийн тархалт', 'Ялгаа хэвийн', 'Хэвийн+Дисперс тэнцүү', 'Хэвийн+Дисперс тэнцүү'],
                'Хэрэглэх тохиолдол': ['Дундаж шалгах', 'Давтан хэмжилт', 'Бүлэг хоорондын', 'Олон бүлгийн']
            }
        
        df_comparison = pd.DataFrame(comparison_data)
        st.dataframe(df_comparison, use_container_width=True)
        
        subheader = "📊 检验方法选择流程图" if lang == 'zh' else "📊 Шалгалтын арга сонгох схем"
        st.subheader(subheader)
        
        col1, col2 = st.columns([1, 2])
        with col1:
            if lang == 'zh':
                st.markdown("""
**需要比较均值？**

↓

**几个组？**
- 1个 → 单样本t检验
- 2个 → 独立样本t检验
- 3个+ → 单因素ANOVA

**同一组多次测量？**
- 是 → 配对样本t检验
- 否 → 上述方法
                """)
            else:
                st.markdown("""
**Дундаж харьцуулах шаардлагатай юу？**

↓

**Хэдэн бүлэг？**
- 1 → Нэг түүврийн t шалгалт
- 2 → Бие даасан t шалгалт
- 3+ → ANOVA

**Нэг бүлэг олон удаа хэмжсэн үү？**
- Тийм → Хосолсон t шалгалт
- Үгүй → Дээрх аргууд
                """)
        
        with col2:
            title = "**实际应用示例**" if lang == 'zh' else "**Бодит хэрэглээний жишээ**"
            st.markdown(title)
            
            if lang == 'zh':
                examples = {
                    "单样本t检验": "检验班级平均成绩(M=75)是否等于学校平均成绩(μ=70)",
                    "配对样本t检验": "比较学生参加培训前(M₁=70)和培训后(M₂=75)的成绩",
                    "独立样本t检验": "比较男生(M₁=75)和女生(M₂=78)的平均成绩",
                    "单因素ANOVA": "比较4个班级的平均成绩：A班(M₁=75), B班(M₂=80), C班(M₃=78), D班(M₄=82)"
                }
            else:
                examples = {
                    "Нэг түүврийн t шалгалт": "Ангийн дундаж оноо(M=75) сургуулийн дундаж оноо(μ=70)-той тэнцүү эсэхийг шалгах",
                    "Хосолсон t шалгалт": "Сурагчдын сургалт өмнө(M₁=70) ба дараах(M₂=75) оноог харьцуулах",
                    "Бие даасан t шалгалт": "Эрэгтэй(M₁=75) ба эмэгтэй(M₂=78) дундаж оноог харьцуулах",
                    "ANOVA": "4 ангийн дундаж оноог харьцуулах: A анги(M₁=75), B анги(M₂=80), C анги(M₃=78), D анги(M₄=82)"
                }
            
            for method, example in examples.items():
                st.markdown(f"**{method}**  \n{example}")
        
        subheader = "📊 信度分析示例" if lang == 'zh' else "📊 Найдвартай байдлын шинжилгээний жишээ"
        st.subheader(subheader)
        
        col1, col2 = st.columns(2)
        with col1:
            title = "**Cronbach's Alpha 解读**" if lang == 'zh' else "**Cronbach's Alpha тайлбар**"
            st.markdown(title)
            
            if lang == 'zh':
                alpha_data = {
                    'Alpha值': ['α ≥ 0.9', '0.8 ≤ α < 0.9', '0.7 ≤ α < 0.8', '0.6 ≤ α < 0.7', 'α < 0.6'],
                    '信度评价': ['优秀', '很好', '可接受', '一般', '不可接受'],
                    '建议': ['✅ 可用', '✅ 可用', '✅ 可用', '⚠️ 谨慎使用', '❌ 不可用']
                }
            else:
                alpha_data = {
                    'Alpha утга': ['α ≥ 0.9', '0.8 ≤ α < 0.9', '0.7 ≤ α < 0.8', '0.6 ≤ α < 0.7', 'α < 0.6'],
                    'Найдвартай байдлын үнэлгээ': ['Маш сайн', 'Сайн', 'Хүлээн зөвшөөрөгдөхүйц', 'Дундаж', 'Хүлээн зөвшөөрөгдөхгүй'],
                    'Зөвлөмж': ['✅ Хэрэглэж болно', '✅ Хэрэглэж болно', '✅ Хэрэглэж болно', '⚠️ Болгоомжтой', '❌ Хэрэглэж болохгүй']
                }
            df_alpha = pd.DataFrame(alpha_data)
            st.dataframe(df_alpha, use_container_width=True)
        
        with col2:
            title = "**中介效应模型**" if lang == 'zh' else "**Завсрын нөлөөний загвар**"
            st.markdown(title)
            if lang == 'zh':
                st.markdown("""
**模型结构**：
```
X → M → Y
```

**路径系数**：
- **c'** = 直接效应 (X→Y)
- **a** = X→M的效应
- **b** = M→Y的效应
- **ab** = 间接效应
- **c** = 总效应 (c = c' + ab)

**中介比例** = ab / c
                """)
            else:
                st.markdown("""
**Загварын бүтэц**：
```
X → M → Y
```

**Замын коэффициент**：
- **c'** = Шууд нөлөө (X→Y)
- **a** = X→M нөлөө
- **b** = M→Y нөлөө
- **ab** = Шууд бус нөлөө
- **c** = Нийт нөлөө (c = c' + ab)

**Завсрын харьцаа** = ab / c
                """)
        
        subheader = "📊 方差齐性检验" if lang == 'zh' else "📊 Дисперсийн тэгш байдлын шалгалт"
        st.subheader(subheader)
        
        title = "**Levene检验的重要性**" if lang == 'zh' else "**Levene шалгалтын ач холбогдол**"
        st.markdown(title)
        if lang == 'zh':
            st.info("""
✅ **为什么要做Levene检验？**
- 检验ANOVA的前提条件：方差齐性
- 如果p > 0.05，说明方差相等，可以进行ANOVA
- 如果p < 0.05，说明方差不相等，需要使用Welch's ANOVA

**解读结果**：
- Levene检验 p > 0.05 ✅ 方差齐性满足
- Levene检验 p < 0.05 ⚠️ 方差不齐，考虑数据转换或使用Welch's ANOVA
            """)
        else:
            st.info("""
✅ **Levene шалгалт яагаад хэрэгтэй вэ？**
- ANOVA-ийн урьдчилсан нөхцөлийг шалгана: дисперсийн тэгш байдал
- Хэрэв p > 0.05 бол дисперс тэнцүү, ANOVA хийж болно
- Хэрэв p < 0.05 бол дисперс тэнцүү биш, Welch's ANOVA ашиглах

**Үр дүнг тайлбарлах**：
- Levene шалгалт p > 0.05 ✅ Дисперс тэгш байдал хангасан
- Levene шалгалт p < 0.05 ⚠️ Дисперс тэгш биш, өгөгдөл хувиргах эсвэл Welch's ANOVA ашиглах
            """)
        
        subheader = "📊 效应量与实际意义" if lang == 'zh' else "📊 Нөлөөний хэмжээ ба бодит утга"
        st.subheader(subheader)
        
        col1, col2 = st.columns(2)
        with col1:
            title = "**Cohen's d 效应量**" if lang == 'zh' else "**Cohen's d нөлөөний хэмжээ**"
            st.markdown(title)
            if lang == 'zh':
                effect_data = {
                    '效应量': ['d = 0.2', 'd = 0.5', 'd = 0.8', 'd > 1.0'],
                    '效应大小': ['小效应', '中等效应', '大效应', '非常大效应'],
                    '实际意义': ['差异较小', '差异中等', '差异明显', '差异非常明显']
                }
            else:
                effect_data = {
                    'Нөлөөний хэмжээ': ['d = 0.2', 'd = 0.5', 'd = 0.8', 'd > 1.0'],
                    'Нөлөөний хэмжээ': ['Бага нөлөө', 'Дунд нөлөө', 'Их нөлөө', 'Маш их нөлөө'],
                    'Бодит утга': ['Ялгаа бага', 'Ялгаа дунд', 'Ялгаа тодорхой', 'Ялгаа маш тодорхой']
                }
            df_effect = pd.DataFrame(effect_data)
            st.dataframe(df_effect, use_container_width=True)
        
        with col2:
            title = "**R² 解释力**" if lang == 'zh' else "**R² тайлбарлах хүч**"
            st.markdown(title)
            if lang == 'zh':
                r2_data = {
                    'R²值': ['R² = 0.01', 'R² = 0.06', 'R² = 0.14', 'R² > 0.20'],
                    '解释力': ['1%', '6%', '14%', '>20%'],
                    '评价': ['很小', '小', '中等', '大']
                }
            else:
                r2_data = {
                    'R² утга': ['R² = 0.01', 'R² = 0.06', 'R² = 0.14', 'R² > 0.20'],
                    'Тайлбарлах хүч': ['1%', '6%', '14%', '>20%'],
                    'Үнэлгээ': ['Маш бага', 'Бага', 'Дунд', 'Их']
                }
            df_r2 = pd.DataFrame(r2_data)
            st.dataframe(df_r2, use_container_width=True)
